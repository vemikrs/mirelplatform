name: E2E Tests

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master, develop ]
  workflow_dispatch:

env:
  # Japanese locale and timezone settings
  TZ: Asia/Tokyo
  LANG: ja_JP.UTF-8
  LC_ALL: ja_JP.UTF-8

jobs:
  validate-setup:
    name: Validate E2E Test Setup
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install E2E test dependencies
        run: npm ci

      - name: Validate E2E setup
        run: npm run test:e2e:validate

      - name: Check Playwright configuration
        run: ./node_modules/.bin/playwright test --list

      - name: Upload validation results
        uses: actions/upload-artifact@v3
        if: always()
        with:
          name: validation-results
          path: |
            test-results/
          retention-days: 7

# Note: Full E2E tests with browser execution are disabled in CI due to network restrictions
# 
# To run E2E tests locally:
# 1. Start services: ./scripts/start-services.sh
# 2. Run tests: npm run test:e2e
# 
# For CI execution with actual services, configure the following in repository settings:
# - Add api.foojay.io to custom allowlist (for Gradle/Java toolchain)
# - Add esm.ubuntu.com to custom allowlist (for apt package manager)
# - Or set up services using Actions setup steps before firewall is enabled
# 
# Once network access is configured, uncomment the jobs at the end of this file
