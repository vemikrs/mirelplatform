server:
  port: ${SERVER_PORT:3000}
  servlet:
    context-path: /mipla2

spring:
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}
  datasource:
    url: ${DATABASE_URL:}
    driver-class-name: ${DATABASE_DRIVER:}
    username: ${DATABASE_USER:}
    password: ${DATABASE_PASS:}
  session:
    jdbc:
      initialize-schema: always
      schema: ${DATABASE_SESSION_SCHEMA:}
      table-name: SPRING_SESSION
    sql:
      init:
        mode: always
  jpa:
    database-platform: ${DATABASE_PLATFORM:}
    hibernate:
      ddl-auto: update
  spring-boot:
    run:
      jvmArguments:: -Xint
  # Redis設定
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
          max-wait: -1ms
  # GitHub OAuth2設定（環境変数未設定時は無効化）
  security:
    oauth2:
      client:
        registration:
          github:
            client-id: ${GITHUB_CLIENT_ID:#{null}}
            client-secret: ${GITHUB_CLIENT_SECRET:#{null}}
            scope:
              - read:user
              - user:email
        provider:
          github:
            user-name-attribute: login

logging:
  level:
    org.springframework.web: DEBUG
    org.springframework.security: DEBUG
    jp.vemi.mirel: DEBUG
    jp.vemi.ste: DEBUG

mipla2:
  security:
    api:
      enabled: true
  config:
    storage-dir: ${MIREL_STORAGE_DIR:}

mirel:
  storage-dir: ${MIREL_STORAGE_DIR:./data/storage}
  # ステンシルレイヤー設定は application-dev.yml で環境固有設定として管理
  apps:
    mste:
      # ProMarker起動時のステンシルマスタ自動リロード設定
      # 開発環境: true (デフォルト) - 起動時に自動リロード
      # 本番環境: false - 手動リロードのみ許可
      auto-reload-stencil-on-startup: ${MIREL_MSTE_AUTO_RELOAD_ON_STARTUP:true}

# OTP設定
otp:
  enabled: ${OTP_ENABLED:true}
  length: ${OTP_LENGTH:6}
  expiration-minutes: ${OTP_EXPIRATION_MINUTES:5}
  max-attempts: ${OTP_MAX_ATTEMPTS:3}
  resend-cooldown-seconds: ${OTP_RESEND_COOLDOWN_SECONDS:60}

# レート制限設定
rate-limit:
  otp:
    request-per-minute: ${RATE_LIMIT_OTP_REQUEST_PER_MINUTE:3}
    verify-per-minute: ${RATE_LIMIT_OTP_VERIFY_PER_MINUTE:5}
  redis:
    fallback-to-memory: ${RATE_LIMIT_REDIS_FALLBACK_TO_MEMORY:true}

# メール設定
email:
  provider: ${EMAIL_PROVIDER:smtp}
  smtp:
    host: ${SMTP_HOST:localhost}
    port: ${SMTP_PORT:1025}
    username: ${SMTP_USERNAME:}
    password: ${SMTP_PASSWORD:}

# Azure Communication Services
azure:
  communication:
    connection-string: ${AZURE_COMMUNICATION_CONNECTION_STRING:}
    email:
      from: ${AZURE_COMMUNICATION_EMAIL_FROM:noreply_mirel@vemi.jp}
      from-name: mirelplatform

# アプリケーションURL
app:
  base-url: ${APP_BASE_URL:http://localhost:5173}
  domain: ${APP_DOMAIN:localhost}

springdoc:
  api-docs:
    path: /api-docs
    enabled: true
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    operations-sorter: method
    tags-sorter: alpha
  show-actuator: false
  paths-to-match:
    - /apps/**
    - /commons/**
    - /auth/**

auth:
  method: jwt
  jwt:
    enabled: true
    secret: ${JWT_SECRET:changeit_changeit_changeit_changeit_changeit_changeit} # 32文字以上
    expiration: 3600
    refresh-expiration: 86400

management:
  endpoints:
    web:
      exposure:
        include: health,metrics,info
  endpoint:
    health:
      show-details: always
  info:
    env:
      enabled: true
    java:
      enabled: true
    os:
      enabled: true

# アプリケーション情報（actuator/info で公開）
info:
  app:
    name: mirelplatform
    version: 1.0.0
    description: 汎用業務アプリケーション基盤
