# Studio API ギャップ分析レポート

## 概要

`docs/studio/03_modeler/api-spec.md` (要件) と 実際の実装 (コード調査に基づく) の厳密な比較結果。

**結論**: ❌ 実装は要件を完全には満たしていません。パスの一貫性、Draft/Release ワークフロー、バリデーション API において重大なギャップが存在します。

## 1. パスとプロトコルの不一致

| カテゴリ       | 要件 (`api-spec.md`)       | 実装                                                                           | ステータス        |
| -------------- | -------------------------- | ------------------------------------------------------------------------------ | ----------------- |
| **ベースパス** | `/mapi/studio/`            | `/api/studio/modeler/` (RPC), `/api/studio/data/` (REST), `/api/studio/flows/` | ⚠️ **不一致**     |
| **プロトコル** | 全て `POST` (RPC スタイル) | REST (`GET`, `PUT`, `DELETE`) と RPC (`POST /{path}`) の混在                   | ⚠️ **一貫性なし** |

## 2. 実装されていないエンドポイント (機能的ギャップ)

### Model Explorer

| 要件           | 実装状況  | 備考                                                                                                                       |
| -------------- | --------- | -------------------------------------------------------------------------------------------------------------------------- |
| `searchModels` | ❌ なし   | 検索エンドポイントが存在しません。                                                                                         |
| `getModel`     | ⚠️ 部分的 | `listModel` はフィールドを取得し、`listModels` はヘッダーを取得します。完全なモデル情報を取得する単一の RPC はありません。 |

### Model Designer (Draft/Publish)

| 要件           | 実装状況 | 備考                                                                                                                                                       |
| -------------- | -------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `saveDraft`    | ⚠️ 曖昧  | `saveModel` は存在しますが、ヘッダーとフィールドが分離されている可能性があります。コントローラー内に明確なドラフトバージョニングロジックが見当たりません。 |
| `publish`      | ❌ なし  | `StuApiController` に明示的な公開 (Publish) エンドポイントがありません。                                                                                   |
| `discardDraft` | ❌ なし  | 変更を破棄するエンドポイントがありません。                                                                                                                 |
| `deleteModel`  | ✅ あり  | `deleteModel` は存在します。                                                                                                                               |

### バリデーション

| 要件       | 実装状況 | 備考                                       |
| ---------- | -------- | ------------------------------------------ |
| `validate` | ❌ なし  | バリデーションエンドポイントがありません。 |

### Release Center

| 要件              | 実装状況  | 備考                                                                                                                 |
| ----------------- | --------- | -------------------------------------------------------------------------------------------------------------------- |
| `publishAll`      | ⚠️ 部分的 | `ReleaseController.createRelease` (`POST /api/studio/releases`) が存在し、この機能をカバーしている可能性があります。 |
| `validateRelease` | ❌ なし   | リリース前の検証エンドポイントがありません。                                                                         |

## 3. 実装の特異点 (追加/相違)

- **DataController** (`/api/studio/data`): RPC仕様には明記されていない完全な REST CRUD を提供しています。
- **FlowController** (`/api/studio/flows`): `api-spec.md` にはありませんが実装されています。

## 推奨事項 (フィードバックに基づく)

1.  **RESTへの移行**: RPCスタイルを廃止し、適切な REST API (`/api/studio/models` 等) に統一する。
2.  **機能実装**: `searchModels` (検索), `validate` (検証), `publish` (公開), `discardDraft` (ドラフト破棄) を実装する。
3.  **ドラフト管理の設計**: Studio ドキュメントに基づき、詳細な設計を行ってから実装する。
