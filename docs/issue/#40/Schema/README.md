# Mirel Schema ドキュメント

## 概要

Mirel Schemaは、mirelplatform上で動作する**ノーコード動的データ管理アプリケーション**です。

プログラミングなしで、ブラウザ上からデータ構造を定義し、即座にデータの登録・検索・編集が可能になります。

## ドキュメント一覧

| No. | ファイル名 | 内容 | 対象読者 |
|-----|-----------|------|----------|
| 1 | [01_要件定義書.md](01_要件定義書.md) | 機能要件・非機能要件 | PO, PM, 開発者 |
| 2 | [02_システム設計書.md](02_システム設計書.md) | アーキテクチャ・ドメインモデル | アーキテクト, 開発者 |
| 3 | [03_API設計書.md](03_API設計書.md) | REST API仕様 | バックエンド, フロントエンド |
| 4 | [04_データベース設計書.md](04_データベース設計書.md) | テーブル定義・ER図 | バックエンド, DBA |
| 5 | [05_画面設計書.md](05_画面設計書.md) | 画面レイアウト・遷移図 | フロントエンド, デザイナー |

## ドキュメント関連図

```
                     +-----------------+
                     | 01_要件定義書    |
                     | (What to build) |
                     +-----------------+
                            |
           +----------------+----------------+
           |                |                |
           v                v                v
  +----------------+ +-------------+ +-------------+
  | 02_システム     | | 03_API      | | 05_画面     |
  | 設計書          | | 設計書       | | 設計書      |
  +----------------+ +-------------+ +-------------+
           |                |
           v                v
         +--------------------+
         | 04_データベース     |
         | 設計書              |
         +--------------------+
```

## 主な機能

| 機能 | 概要 |
|------|------|
| モデル管理 | ブラウザ上でデータ構造（モデル）を定義 |
| レコード管理 | 定義に基づいてデータのCRUD操作 |
| 動的フォーム生成 | モデル定義から入力フォームを自動生成 |
| コードマスタ管理 | ドロップダウン選択肢の管理 |
| バリデーション | 正規表現、文字数、数値範囲の制限 |
| 楽観的ロック | バージョンカラムによる更新競合検出 |
| マルチテナント | テナント単位でのデータ分離 |
| 権限管理 | mirelplatform連携のRBACによるアクセス制御 |
| 監査ログ | 変更履歴の完全な追跡 |
| Webhook | 外部システムへのイベント通知 |
| キャッシュ | Redisによる高速化 |
| アプリ切替 | getApps APIによるアプリケーション間ナビゲーション |

## 例外処理方針

| 例外種別 | クラス | ユーザー表示 | ログ |
|----------|--------|-------------|------|
| 業務例外 | MirelApplicationException | メッセージをそのまま表示 | WARN + スタックトレース |
| システム例外 | MirelSystemException | 「システムエラーが発生しました」固定 | ERROR + スタックトレース |

### エラーコード体系

| コード | カテゴリ | 例 |
|--------|----------|-----|
| SCH-V-XXX | バリデーション | SCH-V-001: 必須項目未入力 |
| SCH-D-XXX | データ整合性 | SCH-D-005: 楽観的ロックエラー |
| SCH-A-XXX | 認証・認可 | SCH-A-002: 権限不足 |
| SCH-S-XXX | システム | SCH-S-001: DB接続エラー |

## ターゲットプラットフォーム

| 項目 | 内容 |
|------|------|
| リポジトリ | [vemikrs/mirelplatform](https://github.com/vemikrs/mirelplatform) |
| ブランチ | `copilot/implement-saas-planning` |

## 技術スタック

| レイヤー | 技術 |
|---------|------|
| Backend | Java 21, Spring Boot 3.3 |
| Frontend | React 18, Vite, TypeScript |
| UI Library | @mirel/ui (Radix UI + Tailwind CSS) |
| State Management | TanStack Query |
| Database | PostgreSQL (JSONB) |
| Testing | JUnit 5, Vitest, Playwright |

## 用語対応表（旧Flex → Mirel Schema）

| 旧用語 | 新用語 | 説明 |
|--------|--------|------|
| Flex | Mirel Schema | プロダクト名 |
| Entity | Model | データ構造の定義 |
| Transaction | Record | 実データ |
| Domain | Schema | モデルの別名 |
| flex_ | sch_ | テーブル接頭辞 |
| /apps/flex/api | /apps/schema/api | APIパス |

## 更新履歴

| 日付 | 版数 | 内容 |
|------|------|------|
| 2025-11-28 | 1.0 | 初版作成（ゼロベース設計） |
| 2025-11-28 | 2.0 | ドキュメント分割（5ファイル構成へ再構成） |
| 2025-11-28 | 3.0 | 名称変更（Flex→Mirel Schema）、API拡張、監査カラム追加、バリデーション機能追加 |
| 2025-11-28 | 4.0 | 拡張性向上：マルチテナント、RBAC権限管理、監査ログ、Webhook、キャッシュ設計追加 |
| 2025-11-28 | 5.0 | mirelplatform準拠：例外処理設計、楽観的ロック（version）、論理削除（delete_flag）、getApps API、ロール削除API追加 |
