# mirel schema（LCAP/NCAP 版）

## データモデルエクスプローラ & モデル定義エディタ

### ― 概要書 & ワイヤーフレーム ―

---

# 1. アプリ鳥瞰図（LCAP構造）

mirel schemaは、mirel LCAP 全体のうち **「データモデル構築・管理」** を担うコンポーネントである。

```
┌───────────────────────────────────────────────────────────────┐
│                          mirel (LCAP)                          │
│                                                               │
│  ┌───────────────────────┐  ┌──────────────────────────────┐  │
│  │  UI/APP Builder        │  │   Automation (Flow)          │  │
│  │  - Form Designer       │  │   - Rules / Events           │  │
│  │  - Page/Layout Builder │  │   - Integrations             │  │
│  └───────────────┬────────┘  └───────────┬──────────────────┘  │
│                  │                         │                     │
│     (本ドキュメント範囲)                 │                     │
│  ┌───────────────▼──────────────────────┐ │                     │
│  │           Data Model Layer            │ │                     │
│  │        = mirel schema                 │ │                     │
│  │   - Entity / View / Code 管理         │ │                     │
│  │   - DomainTree / Relation / Lint      │ │                     │
│  └───────────────┬──────────────────────┘ │                     │
│                  │                         │                     │
│  ┌───────────────▼─────────────────────────▼──────────────────┐ │
│  │                 Execution Layer (Runtime)                    │ │
│  │       - 自動生成フォーム、一覧、API、権限、実データ             │ │
│  └────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────┘
```

---

# 2. 目的・コンセプト

## 2.1 mirel schema の目的

* **アプリのデータ構造をノーコードで設計できる**
* エンティティ／ビュー／コードマスタを **統一UIで管理できる**
* Builder（設計）と Runtime（実行）を明確に分離する
* **現代的LCAP UI/UX に再構築する**

## 2.2 コアコンセプト

1. **Explorer（探索）**
   モデル全体の構造を俯瞰できる。
2. **Designer（設計）**
   ツリー編集＋プロパティ編集でモデル構築。
3. **Draft / Publish（安全性）**
   設計変更は草稿→公開のワークフローで運用。
4. **Preview（即時性）**
   定義したモデルがどのようにUI生成されるか素早く確認。
5. **Extendable（拡張性）**
   View（結合・投影）／外部データ接続にも対応できる構造。

---

# 3. 画面体系（Screen Overview）

```
mirel schema
│
├── Model Explorer（モデル探索）
│     ├── Entity List
│     ├── View List
│     ├── Code List
│     └── Model Overview（Fields / Relations / Usage）
│
└── Model Designer（モデル定義編集）
      ├── Domain Tree（辞書ツリー）
      ├── Field Editor（Primitive）
      ├── Domain Editor（Nested Domain）
      └── Draft / Publish
```

* Explorer と Designer は分離しつつも、1クリックで相互遷移可能
* View / Code / Entity が統一された体験で扱えることが核心

---

# 4. ワイヤーフレーム（Wireframes）

以下は UI構造（低～中解像度のワイヤーフレーム）を Markdown で表したもの。

---

# 4.1 モデルエクスプローラ（Data Model Explorer）

```
┌──────────────────────────────────────────────────────────────┐
│ App Header                                                    │
│  - アプリ名切替                                              │
│  - 検索バー／最近開いたモデル                                 │
│  - Draft 状態 / Publish ボタン                                │
├──────────────────────────────────────────────────────────────┤
│ ■ 左：モデルリスト（Explorer）                                │
│                                                              │
│  Search…                                                     │
│                                                              │
│  ENTITY                                                      │
│   - Customer                                                 │
│   - Order                                                    │
│   - OrderLine                                                │
│   - Shipment                                                 │
│   ...（100件想定）                                          │
│                                                              │
│  VIEW                                                        │
│   - OrderSummaryView                                         │
│   - CustomerRankingView                                      │
│                                                              │
│  CODE                                                        │
│   - CountryCode                                              │
│   - CustomerType                                             │
│                                                              │
│   [+] 新規モデル作成                                          │
│                                                              │
├──────────────────────────────────────────────────────────────┤
│ ■ 中央：モデル詳細                                            │
│  Model: Order (Entity)                                       │
│   説明：顧客の注文トランザクション                            │
│                                                              │
│  [Overview] [Fields] [Relations] [Usage]                     │
│                                                              │
│  Overview：                                                  │
│    - Entity ID : order                                       │
│    - Label : 注文                                            │
│    - PK : orderId                                            │
│    - Updated : 2025-11-25                                    │
│                                                              │
│  Fields：表形式                                               │
│   | 表示名  | ID | 型 | UI | PK | 必須 | Code | 操作 |        │
│   |--------|-----|-----|----|----|------|------|------|       │
│   | 注文ID |orderId|string|text| ● | ● |      |Edit  |       │
│   | 顧客ID |customerId|string|select| | ● |CustomerType|Edit| │
│   ...                                                          │
│    [+ フィールド追加]                                          │
│                                                              │
│  Relations:                                                   │
│    - Customer : Many-to-One（customerId）                    │
│    - OrderLine : One-to-Many（lines[]）                      │
│                                                              │
│  Usage:                                                       │
│    - OrderEntryForm                                           │
│    - OrderSummaryView                                         │
│                                                              │
├──────────────────────────────────────────────────────────────┤
│ ■ 右：視覚化パネル（ER mini map / Structure tree）            │
│                                                              │
│   Order                                                      │
│     ├── orderId : string                                     │
│     ├── customerId : string → Customer                       │
│     ├── orderDate : date                                     │
│     └── lines : OrderLine[]                                  │
│                                                              │
│   ノードクリックで該当モデル詳細へジャンプ                      │
└──────────────────────────────────────────────────────────────┘
```

---

# 4.2 モデル定義エディタ（Model Designer）

```
┌──────────────────────────────────────────────────────────────┐
│ Model: Order (Entity)                                        │
│ Draft: ● 4件の未公開変更があります                         │
│ [変更破棄] [保存] [保存して公開]                              │
├──────────────────────────────────────────────────────────────┤
│ ■ 左：辞書ツリー（Domain Tree）                              │
│                                                              │
│ Order                                                        │
│   ├── orderId : string* （PK）                               │
│   ├── customerId : string [Code: CustomerType]               │
│   ├── orderDate : date                                       │
│   └── lines : DOMAIN (OrderLine)[*]                          │
│         ├── lineId : string                                  │
│         ├── qty : number                                     │
│         └── price : number                                   │
│                                                              │
│ ※ドラッグで順序入替、右クリックで追加/削除                   │
├──────────────────────────────────────────────────────────────┤
│ ■ 右：プロパティ編集パネル（Properties）                      │
│                                                              │
│ Node: customerId                                             │
│                                                              │
│ [基本] [表示] [バリデーション] [関連]                        │
│                                                              │
│ 基本：                                                       │
│   フィールドID       customerId                              │
│   表示名             顧客ID                                  │
│   型                 string ▼                                 │
│   コードグループ     CustomerType ▼                          │
│   必須               [✔]                                     │
│   PK                 [ ]                                     │
│                                                              │
│ 表示：                                                      │
│   UIコンポーネント     selectbox ▼                           │
│   プレースホルダ       "顧客を選択"                           │
│   説明文               "取引先を選択してください"              │
│                                                              │
│ バリデーション：                                            │
│   最小文字数 1                                              │
│   最大文字数 20                                             │
│   正規表現   /^[A-Z0-9]+$/                                   │
│                                                              │
│ 関連：                                                      │
│   参照先エンティティ   Customer                              │
│   参照キー            customerId                              │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

---

# 5. 設計思想（Design Principles）

## 5.1 Explorer / Designer の二層構造

* Explorer：構造を俯瞰し、モデルを探す
* Designer：選択モデルの編集と構築

## 5.2 Draft / Publish

* スキーマ変更はすべて Draft として一時保存
* Publish により、Runtimeへ反映

## 5.3 Domain Tree as a Single Source of Truth

* モデルの階層構造をツリーで一元管理
* UI/Validation/APIすべてこの辞書の情報から生成可能

## 5.4 エンティティ／ビュー／コードの統一体験

* LCAP によくある「モデルの散在」を避け、
  すべてのモデルを Explorer で統一管理

---

# 6. 付録：推奨ディレクトリ構造（Docs）

```
docs/
  schema/
    overview.md       ← 本ドキュメント
    explorer.md       ← 画面ごとの詳細仕様
    designer.md       ← モデル定義エディタ詳細
    tokens.md         ← UIデザイントークン
    usecases/
       create-entity.md
       edit-field.md
       publish-schema.md
```

---

# 以上
