# ãƒ“ã‚¸ãƒã‚¹ãƒ»ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ©Ÿèƒ½ è¨­è¨ˆæ›¸

## ğŸ“‹ æ¦‚è¦

é¡§å®¢ç²å¾—ãƒ»åç›Šæœ€å¤§åŒ–ã‚’æ”¯æ´ã™ã‚‹ãƒ“ã‚¸ãƒã‚¹æ©Ÿèƒ½ç¾¤ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Business & Marketing Features                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                    Growth & Acquisition                                      â”‚ â”‚
â”‚   â”‚                                                                              â”‚ â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚ â”‚
â”‚   â”‚  â”‚   Referral   â”‚    â”‚  Affiliate   â”‚    â”‚   Coupon     â”‚                  â”‚ â”‚
â”‚   â”‚  â”‚   Program    â”‚    â”‚   Program    â”‚    â”‚   Engine     â”‚                  â”‚ â”‚
â”‚   â”‚  â”‚              â”‚    â”‚              â”‚    â”‚              â”‚                  â”‚ â”‚
â”‚   â”‚  â”‚ æ—¢å­˜é¡§å®¢ã‹ã‚‰  â”‚    â”‚ ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼   â”‚    â”‚ ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ â”‚                  â”‚ â”‚
â”‚   â”‚  â”‚ æ–°è¦ç²å¾—     â”‚    â”‚ ç´¹ä»‹å ±é…¬     â”‚    â”‚ å‰²å¼•ç®¡ç†     â”‚                  â”‚ â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚                                          â”‚
â”‚                                         â–¼                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                   Optimization & Testing                                     â”‚ â”‚
â”‚   â”‚                                                                              â”‚ â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚ â”‚
â”‚   â”‚  â”‚    A/B       â”‚    â”‚   Feature    â”‚    â”‚   User       â”‚                  â”‚ â”‚
â”‚   â”‚  â”‚  Testing     â”‚    â”‚   Flags      â”‚    â”‚  Segments    â”‚                  â”‚ â”‚
â”‚   â”‚  â”‚              â”‚    â”‚              â”‚    â”‚              â”‚                  â”‚ â”‚
â”‚   â”‚  â”‚ æ©Ÿèƒ½æ¯”è¼ƒå®Ÿé¨“  â”‚    â”‚ æ®µéšãƒªãƒªãƒ¼ã‚¹ â”‚    â”‚ ã‚¿ãƒ¼ã‚²ãƒ†ã‚£ãƒ³ã‚°â”‚                  â”‚ â”‚
â”‚   â”‚  â”‚ ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ â”‚   â”‚ ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ  â”‚   â”‚ ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºâ”‚                  â”‚ â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚                                          â”‚
â”‚                                         â–¼                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                        Integration                                           â”‚ â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚   â”‚  â”‚  Stripe  â”‚  PayPal  â”‚  Analytics  â”‚  CRM  â”‚  Marketing Automation     â”‚â”‚ â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1ï¸âƒ£ ãƒªãƒ•ã‚¡ãƒ©ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ 

### 1.1 ãƒ•ãƒ­ãƒ¼æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Referral Program Flow                                â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚  Referrer   â”‚                    â”‚   Referee   â”‚                        â”‚
â”‚  â”‚  (ç´¹ä»‹è€…)   â”‚                    â”‚  (è¢«ç´¹ä»‹è€…) â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚         â”‚                                  â”‚                                â”‚
â”‚         â–¼                                  â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚                                â”‚
â”‚  â”‚ ç´¹ä»‹ãƒªãƒ³ã‚¯  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€å…±æœ‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                                â”‚
â”‚  â”‚ ç”Ÿæˆ        â”‚                           â”‚                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â–¼                                â”‚
â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                                    â”‚  ãƒªãƒ³ã‚¯çµŒç”±  â”‚                         â”‚
â”‚                                    â”‚  ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—â”‚                         â”‚
â”‚                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                           â”‚                                â”‚
â”‚                                           â–¼                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Tracking & Attribution                           â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚   Cookie/Session â†’ Signupè¨˜éŒ² â†’ ç´ä»˜ã‘ä¿å­˜ â†’ å ±é…¬æ¡ä»¶ãƒã‚§ãƒƒã‚¯        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚                                      â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚         â–¼                           â–¼                           â–¼         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Referrer   â”‚            â”‚  Referee    â”‚            â”‚  Admin      â”‚   â”‚
â”‚  â”‚  Reward     â”‚            â”‚  Bonus      â”‚            â”‚  Dashboard  â”‚   â”‚
â”‚  â”‚  ãƒ»ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ â”‚            â”‚  ãƒ»åˆæœˆå‰²å¼•  â”‚            â”‚  ãƒ»çµ±è¨ˆ     â”‚   â”‚
â”‚  â”‚  ãƒ»å»¶é•·æœˆ    â”‚            â”‚  ãƒ»è¿½åŠ æ©Ÿèƒ½  â”‚            â”‚  ãƒ»ãƒ¬ãƒãƒ¼ãƒˆ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

```java
@Entity
@Table(name = "referral_codes")
public class ReferralCode {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private String id;

    @Column(nullable = false, unique = true)
    private String code; // "MIREL-ABC123" å½¢å¼

    @Column(nullable = false)
    private String referrerUserId;

    private String referrerTenantId;

    @Enumerated(EnumType.STRING)
    private ReferralType type; // USER, PARTNER, CAMPAIGN

    private int usageLimit; // 0 = ç„¡åˆ¶é™
    private int usageCount = 0;

    private LocalDateTime expiresAt;
    private boolean isActive = true;

    private LocalDateTime createdAt;
}

@Entity
@Table(name = "referrals")
public class Referral {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private String id;

    @Column(nullable = false)
    private String referralCodeId;

    @Column(nullable = false)
    private String refereeUserId;

    private String refereeTenantId;

    @Enumerated(EnumType.STRING)
    private ReferralStatus status; // PENDING, QUALIFIED, REWARDED, EXPIRED

    // å ±é…¬æƒ…å ±
    private boolean referrerRewarded = false;
    private LocalDateTime referrerRewardedAt;

    private boolean refereeRewarded = false;
    private LocalDateTime refereeRewardedAt;

    private LocalDateTime qualifiedAt; // æœ‰æ–™è»¢æ›ãªã©ã®æ¡ä»¶é”æˆæ—¥
    private LocalDateTime createdAt;
}

@Entity
@Table(name = "referral_rewards")
public class ReferralReward {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private String id;

    @Column(nullable = false)
    private String referralId;

    @Enumerated(EnumType.STRING)
    private RewardRecipient recipient; // REFERRER, REFEREE

    @Enumerated(EnumType.STRING)
    private RewardType type; // CREDIT, DISCOUNT_PERCENT, EXTENSION_DAYS, FEATURE_UNLOCK

    private BigDecimal amount; // é‡‘é¡ or ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆ

    private int durationDays; // å»¶é•·æ—¥æ•°

    @Enumerated(EnumType.STRING)
    private RewardStatus status; // PENDING, APPLIED, EXPIRED

    private LocalDateTime appliedAt;
    private LocalDateTime expiresAt;
}
```

### 1.3 å ±é…¬è¨­å®šä¾‹

| ãƒ—ãƒ©ãƒ³ | ç´¹ä»‹è€…å ±é…¬ | è¢«ç´¹ä»‹è€…å ±é…¬ | æ¡ä»¶ |
|--------|------------|--------------|------|
| Standard | Â¥1,000ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ | åˆæœˆ20%OFF | æœ‰æ–™è»¢æ›å¾Œ |
| Professional | Â¥3,000ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ | åˆæœˆ30%OFF | æœ‰æ–™è»¢æ›å¾Œ |
| Enterprise | å€‹åˆ¥äº¤æ¸‰ | å€‹åˆ¥äº¤æ¸‰ | å¥‘ç´„ç· çµå¾Œ |

---

## 2ï¸âƒ£ ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒ—ãƒ­ã‚°ãƒ©ãƒ 

### 2.1 æ¦‚è¦

ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ä¼æ¥­ãƒ»ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼å‘ã‘ã®æˆæœå ±é…¬å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Affiliate Program Structure                            â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Partner Tiers                                                       â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚  Bronze    â”‚  â”‚  Silver    â”‚  â”‚   Gold     â”‚  â”‚  Platinum  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  10%é‚„å…ƒ   â”‚  â”‚  15%é‚„å…ƒ   â”‚  â”‚  20%é‚„å…ƒ   â”‚  â”‚  25%+äº¤æ¸‰  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  ï½5ä»¶/æœˆ  â”‚  â”‚  6-20ä»¶/æœˆ â”‚  â”‚  21-50ä»¶/æœˆâ”‚  â”‚  50ä»¶è¶…/æœˆ â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Payout Flow                                                         â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  Conversion â†’ Attribution â†’ Commissionè¨ˆç®— â†’ æœ€ä½æ”¯æ‰•é¡åˆ°é”          â”‚  â”‚
â”‚  â”‚                                    â†“                                 â”‚  â”‚
â”‚  â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚  â”‚
â”‚  â”‚                            â”‚  æœˆæ¬¡æ”¯æ‰•ã„   â”‚                          â”‚  â”‚
â”‚  â”‚                            â”‚  (éŠ€è¡Œ/PayPal)â”‚                          â”‚  â”‚
â”‚  â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

```java
@Entity
@Table(name = "affiliate_partners")
public class AffiliatePartner {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private String id;

    @Column(nullable = false)
    private String userId; // ç®¡ç†ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

    private String companyName;
    private String contactEmail;

    @Enumerated(EnumType.STRING)
    private PartnerTier tier; // BRONZE, SILVER, GOLD, PLATINUM

    private BigDecimal commissionRate; // 0.10 = 10%

    @Column(columnDefinition = "jsonb")
    private String payoutInfo; // æ”¯æ‰•ã„æƒ…å ±

    @Enumerated(EnumType.STRING)
    private PartnerStatus status; // PENDING, ACTIVE, SUSPENDED

    private LocalDateTime approvedAt;
    private LocalDateTime createdAt;
}

@Entity
@Table(name = "affiliate_commissions")
public class AffiliateCommission {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private String id;

    @Column(nullable = false)
    private String partnerId;

    @Column(nullable = false)
    private String referralId;

    private String invoiceId; // ç´ä»˜ãè«‹æ±‚æ›¸

    private BigDecimal grossAmount; // èª²é‡‘é¡
    private BigDecimal commissionRate;
    private BigDecimal commissionAmount;

    @Enumerated(EnumType.STRING)
    private CommissionStatus status; // PENDING, APPROVED, PAID, REJECTED

    private String payoutBatchId;
    private LocalDateTime paidAt;

    private LocalDateTime createdAt;
}
```

---

## 3ï¸âƒ£ ã‚¯ãƒ¼ãƒãƒ³ã‚¨ãƒ³ã‚¸ãƒ³

### 3.1 ã‚¯ãƒ¼ãƒãƒ³ã‚¿ã‚¤ãƒ—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Coupon Types                                       â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  Fixed Amount  â”‚  â”‚   Percentage   â”‚  â”‚   Free Trial   â”‚               â”‚
â”‚  â”‚                â”‚  â”‚                â”‚  â”‚                â”‚               â”‚
â”‚  â”‚  Â¥1,000 OFF    â”‚  â”‚    20% OFF     â”‚  â”‚  30æ—¥é–“ç„¡æ–™    â”‚               â”‚
â”‚  â”‚                â”‚  â”‚                â”‚  â”‚                â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Constraints                                                        â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚ æœŸé–“é™å®š     â”‚  â”‚ åˆ©ç”¨å›æ•°åˆ¶é™  â”‚  â”‚ æœ€ä½è³¼å…¥é¡   â”‚              â”‚   â”‚
â”‚  â”‚  â”‚ 2025/01-03   â”‚  â”‚ å…ˆç€100å    â”‚  â”‚ Â¥10,000ä»¥ä¸Š  â”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚ ãƒ—ãƒ©ãƒ³é™å®š   â”‚  â”‚ æ–°è¦é™å®š     â”‚  â”‚ 1ãƒ†ãƒŠãƒ³ãƒˆ1å›  â”‚              â”‚   â”‚
â”‚  â”‚  â”‚ Proã®ã¿é©ç”¨  â”‚  â”‚ åˆå›è³¼å…¥ã®ã¿  â”‚  â”‚              â”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

```java
@Entity
@Table(name = "coupons")
public class Coupon {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private String id;

    @Column(nullable = false, unique = true)
    private String code; // "WELCOME20", "SUMMER2025"

    private String name;
    private String description;

    @Enumerated(EnumType.STRING)
    private DiscountType discountType; // FIXED, PERCENTAGE, FREE_TRIAL

    private BigDecimal discountValue; // é‡‘é¡ or ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆ
    private int freeTrialDays; // FREE_TRIALæ™‚

    // åˆ¶ç´„
    private BigDecimal minPurchaseAmount;
    private int maxUsageCount; // å…¨ä½“ã§ã®åˆ©ç”¨ä¸Šé™
    private int maxUsagePerTenant; // ãƒ†ãƒŠãƒ³ãƒˆã‚ãŸã‚Šåˆ©ç”¨ä¸Šé™

    @ElementCollection
    @CollectionTable(name = "coupon_applicable_plans")
    private Set<String> applicablePlanIds; // ç©º = å…¨ãƒ—ãƒ©ãƒ³

    private boolean newCustomersOnly = false;

    private LocalDateTime startsAt;
    private LocalDateTime expiresAt;

    private int usageCount = 0;
    private boolean isActive = true;

    private LocalDateTime createdAt;
}

@Entity
@Table(name = "coupon_usages")
public class CouponUsage {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private String id;

    @Column(nullable = false)
    private String couponId;

    @Column(nullable = false)
    private String tenantId;

    private String userId;
    private String subscriptionId;

    private BigDecimal discountApplied;

    private LocalDateTime usedAt;
}
```

### 3.3 æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯

```java
@Service
public class CouponValidationService {

    public CouponValidationResult validate(String code, String tenantId, BigDecimal purchaseAmount) {
        Coupon coupon = couponRepository.findByCode(code)
            .orElseThrow(() -> new CouponNotFoundException());

        // æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯
        if (!coupon.isActive()) {
            return CouponValidationResult.invalid("ã‚¯ãƒ¼ãƒãƒ³ã¯ç„¡åŠ¹ã§ã™");
        }

        // æœŸé–“ãƒã‚§ãƒƒã‚¯
        LocalDateTime now = LocalDateTime.now();
        if (coupon.getStartsAt() != null && now.isBefore(coupon.getStartsAt())) {
            return CouponValidationResult.invalid("ã‚¯ãƒ¼ãƒãƒ³ã¯ã¾ã æœ‰åŠ¹ã§ã¯ã‚ã‚Šã¾ã›ã‚“");
        }
        if (coupon.getExpiresAt() != null && now.isAfter(coupon.getExpiresAt())) {
            return CouponValidationResult.invalid("ã‚¯ãƒ¼ãƒãƒ³ã¯æœŸé™åˆ‡ã‚Œã§ã™");
        }

        // åˆ©ç”¨å›æ•°ãƒã‚§ãƒƒã‚¯
        if (coupon.getMaxUsageCount() > 0 && 
            coupon.getUsageCount() >= coupon.getMaxUsageCount()) {
            return CouponValidationResult.invalid("ã‚¯ãƒ¼ãƒãƒ³ã®åˆ©ç”¨ä¸Šé™ã«é”ã—ã¾ã—ãŸ");
        }

        // ãƒ†ãƒŠãƒ³ãƒˆåˆ©ç”¨å›æ•°ãƒã‚§ãƒƒã‚¯
        int tenantUsageCount = couponUsageRepository.countByTenantId(tenantId);
        if (coupon.getMaxUsagePerTenant() > 0 && 
            tenantUsageCount >= coupon.getMaxUsagePerTenant()) {
            return CouponValidationResult.invalid("ã“ã®ã‚¯ãƒ¼ãƒãƒ³ã¯æ—¢ã«ä½¿ç”¨æ¸ˆã¿ã§ã™");
        }

        // æœ€ä½è³¼å…¥é¡ãƒã‚§ãƒƒã‚¯
        if (coupon.getMinPurchaseAmount() != null && 
            purchaseAmount.compareTo(coupon.getMinPurchaseAmount()) < 0) {
            return CouponValidationResult.invalid(
                String.format("æœ€ä½è³¼å…¥é¡ Â¥%s ä»¥ä¸ŠãŒå¿…è¦ã§ã™", coupon.getMinPurchaseAmount())
            );
        }

        // å‰²å¼•é¡è¨ˆç®—
        BigDecimal discount = calculateDiscount(coupon, purchaseAmount);

        return CouponValidationResult.valid(coupon, discount);
    }
}
```

---

## 4ï¸âƒ£ A/Bãƒ†ã‚¹ãƒˆãƒ»æ©Ÿèƒ½ãƒ•ãƒ©ã‚°

### 4.1 æ©Ÿèƒ½ãƒ•ãƒ©ã‚°ã‚·ã‚¹ãƒ†ãƒ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Feature Flag System                                   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Flag Definition                                                     â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚  Key: new_dashboard_design                                   â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  Type: boolean | percentage | segment                        â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  Default: false                                              â”‚    â”‚  â”‚
â”‚  â”‚  â”‚                                                              â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  Rules:                                                      â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    - tenant in ["beta-testers"] â†’ true                      â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    - plan == "enterprise" â†’ true                            â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    - percentage(30%) â†’ true (A/Bãƒ†ã‚¹ãƒˆ)                      â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Evaluation Flow                                                     â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  Request â†’ Contextå–å¾— â†’ Rulesè©•ä¾¡ â†’ Flagå€¤è¿”å´ â†’ åˆ†å²å‡¦ç†          â”‚  â”‚
â”‚  â”‚            (user, tenant,   (å„ªå…ˆé †ä½ã§)                             â”‚  â”‚
â”‚  â”‚             plan, etc.)                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

```java
@Entity
@Table(name = "feature_flags")
public class FeatureFlag {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private String id;

    @Column(nullable = false, unique = true)
    private String key; // "new_dashboard_design"

    private String name;
    private String description;

    @Enumerated(EnumType.STRING)
    private FlagType type; // BOOLEAN, PERCENTAGE, SEGMENT, MULTIVARIATE

    private boolean defaultValue = false;

    @Column(columnDefinition = "jsonb")
    private String rules; // ãƒ«ãƒ¼ãƒ«å®šç¾© (JSON)

    @Column(columnDefinition = "jsonb")
    private String variants; // ãƒãƒ«ãƒãƒãƒªã‚¨ã‚¤ãƒˆç”¨

    private boolean isActive = true;

    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
}

@Entity
@Table(name = "feature_flag_overrides")
public class FeatureFlagOverride {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private String id;

    @Column(nullable = false)
    private String flagId;

    @Enumerated(EnumType.STRING)
    private OverrideType type; // TENANT, USER

    private String targetId; // tenantId or userId

    private boolean value;
    private String variant; // ãƒãƒ«ãƒãƒãƒªã‚¨ã‚¤ãƒˆç”¨

    private LocalDateTime expiresAt;
    private LocalDateTime createdAt;
}
```

### 4.3 ä½¿ç”¨ä¾‹

```java
// Backend
@Service
public class DashboardService {
    
    @Autowired
    private FeatureFlagService featureFlags;
    
    public DashboardResponse getDashboard() {
        boolean useNewDesign = featureFlags.isEnabled(
            "new_dashboard_design",
            FeatureContext.builder()
                .tenantId(executionContext.getCurrentTenantId())
                .userId(executionContext.getCurrentUserId())
                .plan(executionContext.getCurrentPlan())
                .build()
        );
        
        if (useNewDesign) {
            return buildNewDashboard();
        }
        return buildLegacyDashboard();
    }
}
```

```typescript
// Frontend
function Dashboard() {
  const { isEnabled, variant } = useFeatureFlag('new_dashboard_design');
  
  if (isEnabled) {
    return <NewDashboard variant={variant} />;
  }
  
  return <LegacyDashboard />;
}
```

---

## ğŸ“Š å·¥æ•°è¦‹ç©

| æ©Ÿèƒ½ | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | åˆè¨ˆ |
|------|----------------|--------------|------|
| ãƒªãƒ•ã‚¡ãƒ©ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ  | 3äººæ—¥ | 5äººæ—¥ | 8äººæ—¥ |
| ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆï¼ˆåŸºæœ¬ï¼‰ | 5äººæ—¥ | 10äººæ—¥ | 15äººæ—¥ |
| ã‚¯ãƒ¼ãƒãƒ³ã‚¨ãƒ³ã‚¸ãƒ³ | 3äººæ—¥ | 5äººæ—¥ | 8äººæ—¥ |
| æ©Ÿèƒ½ãƒ•ãƒ©ã‚°ã‚·ã‚¹ãƒ†ãƒ  | 3äººæ—¥ | 8äººæ—¥ | 11äººæ—¥ |
| A/Bãƒ†ã‚¹ãƒˆåˆ†æ | 5äººæ—¥ | 5äººæ—¥ | 10äººæ—¥ |
| **åˆè¨ˆ** | **19äººæ—¥** | **33äººæ—¥** | **52äººæ—¥** |

---

*æ¬¡: [é«˜åº¦ãªåˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒ†ã‚£ãƒ³ã‚°](./04_analytics-reporting.md)*
