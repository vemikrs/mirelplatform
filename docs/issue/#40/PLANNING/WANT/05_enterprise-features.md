# ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ©Ÿèƒ½ è¨­è¨ˆæ›¸

## ğŸ“‹ æ¦‚è¦

å¤§ä¼æ¥­ãƒ»é«˜ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶é¡§å®¢å‘ã‘ã®é«˜åº¦ãªæ©Ÿèƒ½ç¾¤ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Enterprise Features Overview                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                     Identity & Access Management                             â”‚ â”‚
â”‚   â”‚                                                                              â”‚ â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚   â”‚  â”‚   SAML 2.0   â”‚  â”‚   OIDC /     â”‚  â”‚    SCIM      â”‚  â”‚    JIT       â”‚   â”‚ â”‚
â”‚   â”‚  â”‚    SSO       â”‚  â”‚   OAuth2     â”‚  â”‚  Provisioningâ”‚  â”‚   Creation   â”‚   â”‚ â”‚
â”‚   â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚   â”‚ â”‚
â”‚   â”‚  â”‚ IdPé€£æº      â”‚  â”‚ Google/Azure â”‚  â”‚ è‡ªå‹•åŒæœŸ     â”‚  â”‚ åˆå›ãƒ­ã‚°ã‚¤ãƒ³ â”‚   â”‚ â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                       Compliance & Governance                                â”‚ â”‚
â”‚   â”‚                                                                              â”‚ â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚   â”‚  â”‚    Data      â”‚  â”‚   Audit      â”‚  â”‚   Custom     â”‚  â”‚  Compliance  â”‚   â”‚ â”‚
â”‚   â”‚  â”‚  Residency   â”‚  â”‚    Logs      â”‚  â”‚  Retention   â”‚  â”‚   Reports    â”‚   â”‚ â”‚
â”‚   â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚   â”‚ â”‚
â”‚   â”‚  â”‚ åœ°åŸŸãƒ‡ãƒ¼ã‚¿ä¿å­˜â”‚  â”‚ å…¨æ“ä½œè¨˜éŒ²   â”‚  â”‚ ãƒ‡ãƒ¼ã‚¿ä¿æŒ   â”‚  â”‚ SOC2/ISOå¯¾å¿œâ”‚   â”‚ â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                      Dedicated Infrastructure                                â”‚ â”‚
â”‚   â”‚                                                                              â”‚ â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚   â”‚  â”‚   Dedicated  â”‚  â”‚   Custom     â”‚  â”‚   White      â”‚  â”‚    VPN/      â”‚   â”‚ â”‚
â”‚   â”‚  â”‚   Instances  â”‚  â”‚    SLA       â”‚  â”‚  Labeling    â”‚  â”‚  IP Restrict â”‚   â”‚ â”‚
â”‚   â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚   â”‚ â”‚
â”‚   â”‚  â”‚ å°‚ç”¨ç’°å¢ƒ     â”‚  â”‚ 99.95%+ä¿è¨¼  â”‚  â”‚ ãƒ–ãƒ©ãƒ³ãƒ‰å¤‰æ›´ â”‚  â”‚ æ¥ç¶šåˆ¶é™    â”‚   â”‚ â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1ï¸âƒ£ SAML 2.0 / OIDC SSO

### 1.1 èªè¨¼ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SAML 2.0 SSO Flow                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  User   â”‚        â”‚   Mirel    â”‚         â”‚    IdP      â”‚                 â”‚
â”‚  â”‚ Browser â”‚        â”‚  Platform  â”‚         â”‚ (Okta/Azure)â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚       â”‚                   â”‚                       â”‚                         â”‚
â”‚       â”‚  1. Access        â”‚                       â”‚                         â”‚
â”‚       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                       â”‚                         â”‚
â”‚       â”‚                   â”‚                       â”‚                         â”‚
â”‚       â”‚  2. SAML Request  â”‚                       â”‚                         â”‚
â”‚       â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚                         â”‚
â”‚       â”‚                   â”‚                       â”‚                         â”‚
â”‚       â”‚  3. Redirect to IdP                       â”‚                         â”‚
â”‚       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                         â”‚
â”‚       â”‚                   â”‚                       â”‚                         â”‚
â”‚       â”‚  4. Authenticate  â”‚                       â”‚                         â”‚
â”‚       â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                         â”‚
â”‚       â”‚                   â”‚                       â”‚                         â”‚
â”‚       â”‚  5. SAML Response â”‚                       â”‚                         â”‚
â”‚       â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚
â”‚       â”‚                   â”‚                       â”‚                         â”‚
â”‚       â”‚  6. POST Response â”‚                       â”‚                         â”‚
â”‚       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                       â”‚                         â”‚
â”‚       â”‚                   â”‚                       â”‚                         â”‚
â”‚       â”‚                   â”‚ 7. Validate           â”‚                         â”‚
â”‚       â”‚                   â”‚    & Create Session   â”‚                         â”‚
â”‚       â”‚                   â”‚                       â”‚                         â”‚
â”‚       â”‚  8. JWT Token     â”‚                       â”‚                         â”‚
â”‚       â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚                         â”‚
â”‚       â”‚                   â”‚                       â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

```java
@Entity
@Table(name = "sso_configurations")
public class SsoConfiguration {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private String id;

    @Column(nullable = false)
    private String tenantId;

    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private SsoProvider provider; // SAML, OIDC

    private String displayName; // "Company SSO"

    // SAML è¨­å®š
    private String entityId;
    private String ssoUrl;
    private String sloUrl; // Single Logout URL
    @Column(columnDefinition = "text")
    private String x509Certificate;

    // OIDC è¨­å®š
    private String issuer;
    private String authorizationEndpoint;
    private String tokenEndpoint;
    private String userInfoEndpoint;
    private String clientId;
    private String clientSecret;
    private String scopes; // "openid profile email"

    // å…±é€šè¨­å®š
    @Enumerated(EnumType.STRING)
    private SsoEnforcement enforcement; // OPTIONAL, REQUIRED, DOMAIN_BASED

    @ElementCollection
    @CollectionTable(name = "sso_email_domains")
    private Set<String> emailDomains; // ["company.com", "company.co.jp"]

    private boolean autoProvision = true; // JITä½œæˆ
    private String defaultRoleId; // æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ­ãƒ¼ãƒ«

    @Column(columnDefinition = "jsonb")
    private String attributeMapping; // SAMLå±æ€§ãƒãƒƒãƒ”ãƒ³ã‚°

    private boolean isActive = true;

    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
}
```

### 1.3 Spring Securityè¨­å®š

```java
@Configuration
@EnableWebSecurity
public class SamlSecurityConfig {

    @Bean
    public SecurityFilterChain samlFilterChain(HttpSecurity http) throws Exception {
        return http
            .securityMatcher("/saml/**")
            .saml2Login(saml -> saml
                .relyingPartyRegistrationRepository(relyingPartyRegistrationRepository())
                .authenticationSuccessHandler(samlSuccessHandler())
            )
            .saml2Logout(Customizer.withDefaults())
            .build();
    }

    @Bean
    public RelyingPartyRegistrationRepository relyingPartyRegistrationRepository() {
        // ãƒ†ãƒŠãƒ³ãƒˆã”ã¨ã®SSOè¨­å®šã‚’å‹•çš„ã«ãƒ­ãƒ¼ãƒ‰
        return new DynamicRelyingPartyRegistrationRepository(ssoConfigurationRepository);
    }

    @Bean
    public AuthenticationSuccessHandler samlSuccessHandler() {
        return (request, response, authentication) -> {
            Saml2AuthenticatedPrincipal principal = 
                (Saml2AuthenticatedPrincipal) authentication.getPrincipal();
            
            // å±æ€§ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
            String email = principal.getFirstAttribute("email");
            String name = principal.getFirstAttribute("displayName");
            
            // JIT Provisioning
            User user = userService.findOrCreateSsoUser(email, name, principal);
            
            // JWTç™ºè¡Œ
            String jwt = jwtService.generateToken(user);
            
            // ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
            response.sendRedirect("/auth/sso/callback?token=" + jwt);
        };
    }
}
```

---

## 2ï¸âƒ£ SCIM 2.0 ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°

### 2.1 SCIM ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SCIM 2.0 Provisioning                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚     IdP       â”‚                          â”‚    Mirel SCIM      â”‚         â”‚
â”‚  â”‚ (Okta/Azure)  â”‚                          â”‚     Endpoint       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚          â”‚                                              â”‚                   â”‚
â”‚          â”‚  POST /scim/v2/Users                        â”‚                   â”‚
â”‚          â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                   â”‚
â”‚          â”‚  (ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ)                              â”‚                   â”‚
â”‚          â”‚                                              â”‚                   â”‚
â”‚          â”‚  PUT /scim/v2/Users/{id}                    â”‚                   â”‚
â”‚          â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                   â”‚
â”‚          â”‚  (ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°)                              â”‚                   â”‚
â”‚          â”‚                                              â”‚                   â”‚
â”‚          â”‚  PATCH /scim/v2/Users/{id}                  â”‚                   â”‚
â”‚          â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                   â”‚
â”‚          â”‚  (å±æ€§æ›´æ–°)                                  â”‚                   â”‚
â”‚          â”‚                                              â”‚                   â”‚
â”‚          â”‚  DELETE /scim/v2/Users/{id}                 â”‚                   â”‚
â”‚          â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                   â”‚
â”‚          â”‚  (ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤/ç„¡åŠ¹åŒ–)                        â”‚                   â”‚
â”‚          â”‚                                              â”‚                   â”‚
â”‚          â”‚  POST /scim/v2/Groups                       â”‚                   â”‚
â”‚          â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                   â”‚
â”‚          â”‚  (ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ)                              â”‚                   â”‚
â”‚          â”‚                                              â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 SCIM ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼

```java
@RestController
@RequestMapping("/scim/v2")
public class ScimController {

    @PostMapping("/Users")
    public ResponseEntity<ScimUser> createUser(
        @RequestBody ScimUser user,
        @RequestHeader("X-Tenant-Id") String tenantId
    ) {
        User created = scimService.createUser(tenantId, user);
        return ResponseEntity.created(URI.create("/scim/v2/Users/" + created.getId()))
            .body(ScimUserMapper.toScim(created));
    }

    @PutMapping("/Users/{id}")
    public ResponseEntity<ScimUser> replaceUser(
        @PathVariable String id,
        @RequestBody ScimUser user,
        @RequestHeader("X-Tenant-Id") String tenantId
    ) {
        User updated = scimService.replaceUser(tenantId, id, user);
        return ResponseEntity.ok(ScimUserMapper.toScim(updated));
    }

    @PatchMapping("/Users/{id}")
    public ResponseEntity<ScimUser> patchUser(
        @PathVariable String id,
        @RequestBody ScimPatchRequest patch,
        @RequestHeader("X-Tenant-Id") String tenantId
    ) {
        User updated = scimService.patchUser(tenantId, id, patch);
        return ResponseEntity.ok(ScimUserMapper.toScim(updated));
    }

    @DeleteMapping("/Users/{id}")
    public ResponseEntity<Void> deleteUser(
        @PathVariable String id,
        @RequestHeader("X-Tenant-Id") String tenantId
    ) {
        scimService.deleteUser(tenantId, id);
        return ResponseEntity.noContent().build();
    }

    @GetMapping("/Users")
    public ResponseEntity<ScimListResponse<ScimUser>> listUsers(
        @RequestParam(required = false) String filter,
        @RequestParam(defaultValue = "1") int startIndex,
        @RequestParam(defaultValue = "100") int count,
        @RequestHeader("X-Tenant-Id") String tenantId
    ) {
        Page<User> users = scimService.listUsers(tenantId, filter, startIndex, count);
        return ResponseEntity.ok(ScimUserMapper.toListResponse(users));
    }
}
```

---

## 3ï¸âƒ£ ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¸ãƒ‡ãƒ³ã‚·ãƒ¼

### 3.1 åœ°åŸŸåˆ¥ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Residency Architecture                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Global Load Balancer                                                â”‚  â”‚
â”‚  â”‚  (GeoIP Routing)                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚                                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚         â–¼                       â–¼                       â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Japan (Tokyo)  â”‚   â”‚  EU (Frankfurt) â”‚   â”‚  US (Virginia)  â”‚         â”‚
â”‚  â”‚                 â”‚   â”‚                 â”‚   â”‚                 â”‚         â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚
â”‚  â”‚ â”‚   App       â”‚ â”‚   â”‚ â”‚   App       â”‚ â”‚   â”‚ â”‚   App       â”‚ â”‚         â”‚
â”‚  â”‚ â”‚   Servers   â”‚ â”‚   â”‚ â”‚   Servers   â”‚ â”‚   â”‚ â”‚   Servers   â”‚ â”‚         â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚
â”‚  â”‚ â”‚   Database  â”‚ â”‚   â”‚ â”‚   Database  â”‚ â”‚   â”‚ â”‚   Database  â”‚ â”‚         â”‚
â”‚  â”‚ â”‚   (Primary) â”‚ â”‚   â”‚ â”‚   (Primary) â”‚ â”‚   â”‚ â”‚   (Primary) â”‚ â”‚         â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚
â”‚  â”‚ â”‚   Storage   â”‚ â”‚   â”‚ â”‚   Storage   â”‚ â”‚   â”‚ â”‚   Storage   â”‚ â”‚         â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                       â”‚                       â”‚                 â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                 â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Metadata Sync Only (No PII)                                        â”‚  â”‚
â”‚  â”‚  ãƒ»ãƒ†ãƒŠãƒ³ãƒˆè¨­å®šåŒæœŸ                                                   â”‚  â”‚
â”‚  â”‚  ãƒ»èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ï¼ˆJWKï¼‰                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ãƒ†ãƒŠãƒ³ãƒˆè¨­å®š

```java
@Entity
@Table(name = "tenant_data_residency")
public class TenantDataResidency {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private String id;

    @Column(nullable = false, unique = true)
    private String tenantId;

    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private DataRegion region; // JAPAN, EU, US, APAC

    @Enumerated(EnumType.STRING)
    private DataResidencyStatus status; // PENDING, ACTIVE, MIGRATING

    // ç§»è¡Œæƒ…å ±
    private String sourceRegion;
    private LocalDateTime migrationStartedAt;
    private LocalDateTime migrationCompletedAt;

    // æ³•çš„è¦ä»¶
    private boolean gdprApplicable;
    private boolean ccpaApplicable;
    private boolean appiApplicable; // æ—¥æœ¬ã®å€‹äººæƒ…å ±ä¿è­·æ³•

    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
}
```

---

## 4ï¸âƒ£ ãƒ›ãƒ¯ã‚¤ãƒˆãƒ©ãƒ™ãƒªãƒ³ã‚°

### 4.1 ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºé …ç›®

| ã‚«ãƒ†ã‚´ãƒª | ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºé …ç›® | èª¬æ˜ |
|----------|------------------|------|
| ãƒ–ãƒ©ãƒ³ãƒ‰ | ãƒ­ã‚´ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã€ãƒ•ã‚¡ãƒ“ã‚³ãƒ³ï¼‰ | ä¼æ¥­ãƒ­ã‚´ã«ç½®ãæ›ãˆ |
| | ã‚¢ãƒ—ãƒªå | ã€ŒMirel Platformã€â†’ã€ŒCompany Portalã€ |
| | ã‚«ãƒ©ãƒ¼ã‚¹ã‚­ãƒ¼ãƒ  | ãƒ—ãƒ©ã‚¤ãƒãƒª/ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ |
| ãƒ‰ãƒ¡ã‚¤ãƒ³ | ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ | app.company.com |
| | ãƒ¡ãƒ¼ãƒ«é€ä¿¡å…ƒ | noreply@company.com |
| è¡¨ç¤º | ãƒ•ãƒƒã‚¿ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ | è‘—ä½œæ¨©è¡¨ç¤ºå¤‰æ›´ |
| | ãƒ˜ãƒ«ãƒ—ãƒªãƒ³ã‚¯ | è‡ªç¤¾ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¸ |

### 4.2 ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

```java
@Entity
@Table(name = "white_label_configs")
public class WhiteLabelConfig {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private String id;

    @Column(nullable = false, unique = true)
    private String tenantId;

    // ãƒ–ãƒ©ãƒ³ãƒ‰
    private String appName;
    private String logoUrl;
    private String faviconUrl;

    // ã‚«ãƒ©ãƒ¼
    private String primaryColor;
    private String secondaryColor;
    private String accentColor;

    // ãƒ‰ãƒ¡ã‚¤ãƒ³
    private String customDomain;
    private boolean customDomainVerified;
    private String sslCertificateId;

    // ãƒ¡ãƒ¼ãƒ«
    private String emailFromName;
    private String emailFromAddress;
    private String emailDomain;
    private boolean emailDomainVerified;

    // UI
    private String footerText;
    private String helpUrl;
    private String privacyPolicyUrl;
    private String termsOfServiceUrl;

    @Column(columnDefinition = "jsonb")
    private String customCss; // è¿½åŠ CSS

    private boolean isActive = true;

    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
}
```

### 4.3 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é©ç”¨

```typescript
// hooks/useWhiteLabel.ts
function useWhiteLabel() {
  const { data: config } = useQuery({
    queryKey: ['whiteLabel'],
    queryFn: () => api.get('/mapi/white-label/config').then(r => r.data),
    staleTime: Infinity,
  });

  useEffect(() => {
    if (!config) return;

    // CSSå¤‰æ•°ã‚’å‹•çš„ã«è¨­å®š
    const root = document.documentElement;
    root.style.setProperty('--color-primary', config.primaryColor);
    root.style.setProperty('--color-secondary', config.secondaryColor);
    root.style.setProperty('--color-accent', config.accentColor);

    // ãƒ•ã‚¡ãƒ“ã‚³ãƒ³å¤‰æ›´
    const favicon = document.querySelector<HTMLLinkElement>('link[rel="icon"]');
    if (favicon && config.faviconUrl) {
      favicon.href = config.faviconUrl;
    }

    // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¿ã‚¤ãƒˆãƒ«
    if (config.appName) {
      document.title = config.appName;
    }
  }, [config]);

  return config;
}
```

---

## 5ï¸âƒ£ IPåˆ¶é™ãƒ»VPNé€£æº

### 5.1 ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™è¨­å®š

```java
@Entity
@Table(name = "tenant_access_policies")
public class TenantAccessPolicy {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private String id;

    @Column(nullable = false)
    private String tenantId;

    // IPåˆ¶é™
    @ElementCollection
    @CollectionTable(name = "allowed_ip_ranges")
    private Set<String> allowedIpRanges; // CIDRå½¢å¼ "192.168.1.0/24"

    private boolean ipRestrictionEnabled = false;

    // æ™‚é–“åˆ¶é™
    private boolean timeRestrictionEnabled = false;
    private String allowedTimeZone;
    private String allowedStartTime; // "09:00"
    private String allowedEndTime; // "18:00"
    private Set<DayOfWeek> allowedDays;

    // ãƒ‡ãƒã‚¤ã‚¹åˆ¶é™
    private boolean deviceRestrictionEnabled = false;
    @ElementCollection
    @CollectionTable(name = "allowed_device_types")
    private Set<String> allowedDeviceTypes; // "desktop", "mobile", "tablet"

    // VPNè¦ä»¶
    private boolean vpnRequired = false;
    @ElementCollection
    @CollectionTable(name = "trusted_vpn_ranges")
    private Set<String> trustedVpnRanges;

    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
}
```

### 5.2 ã‚¢ã‚¯ã‚»ã‚¹æ¤œè¨¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼

```java
@Component
public class AccessPolicyFilter extends OncePerRequestFilter {

    @Autowired
    private TenantAccessPolicyService policyService;

    @Override
    protected void doFilterInternal(
        HttpServletRequest request,
        HttpServletResponse response,
        FilterChain filterChain
    ) throws ServletException, IOException {
        
        String tenantId = extractTenantId(request);
        if (tenantId == null) {
            filterChain.doFilter(request, response);
            return;
        }

        TenantAccessPolicy policy = policyService.getPolicy(tenantId);
        if (policy == null) {
            filterChain.doFilter(request, response);
            return;
        }

        String clientIp = getClientIp(request);
        
        // IPåˆ¶é™ãƒã‚§ãƒƒã‚¯
        if (policy.isIpRestrictionEnabled()) {
            if (!isIpAllowed(clientIp, policy.getAllowedIpRanges())) {
                response.sendError(HttpServletResponse.SC_FORBIDDEN, 
                    "Access denied: IP address not allowed");
                return;
            }
        }

        // VPNè¦ä»¶ãƒã‚§ãƒƒã‚¯
        if (policy.isVpnRequired()) {
            if (!isFromTrustedVpn(clientIp, policy.getTrustedVpnRanges())) {
                response.sendError(HttpServletResponse.SC_FORBIDDEN, 
                    "Access denied: VPN connection required");
                return;
            }
        }

        // æ™‚é–“åˆ¶é™ãƒã‚§ãƒƒã‚¯
        if (policy.isTimeRestrictionEnabled()) {
            if (!isWithinAllowedTime(policy)) {
                response.sendError(HttpServletResponse.SC_FORBIDDEN, 
                    "Access denied: Outside allowed hours");
                return;
            }
        }

        filterChain.doFilter(request, response);
    }

    private boolean isIpAllowed(String clientIp, Set<String> allowedRanges) {
        InetAddress address = InetAddress.getByName(clientIp);
        return allowedRanges.stream()
            .anyMatch(range -> new SubnetUtils(range).getInfo().isInRange(clientIp));
    }
}
```

---

## ğŸ“Š å·¥æ•°è¦‹ç©

| æ©Ÿèƒ½ | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | ã‚¤ãƒ³ãƒ•ãƒ© | åˆè¨ˆ |
|------|----------------|--------------|----------|------|
| SAML 2.0 SSO | 3äººæ—¥ | 10äººæ—¥ | - | 13äººæ—¥ |
| OIDC SSO | 2äººæ—¥ | 5äººæ—¥ | - | 7äººæ—¥ |
| SCIM Provisioning | 2äººæ—¥ | 10äººæ—¥ | - | 12äººæ—¥ |
| ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¸ãƒ‡ãƒ³ã‚·ãƒ¼ | - | 5äººæ—¥ | 20äººæ—¥ | 25äººæ—¥ |
| ãƒ›ãƒ¯ã‚¤ãƒˆãƒ©ãƒ™ãƒªãƒ³ã‚° | 10äººæ—¥ | 5äººæ—¥ | 3äººæ—¥ | 18äººæ—¥ |
| IPåˆ¶é™/VPNé€£æº | 3äººæ—¥ | 5äººæ—¥ | 2äººæ—¥ | 10äººæ—¥ |
| ã‚«ã‚¹ã‚¿ãƒ SLA | 2äººæ—¥ | 5äººæ—¥ | 5äººæ—¥ | 12äººæ—¥ |
| **åˆè¨ˆ** | **22äººæ—¥** | **45äººæ—¥** | **30äººæ—¥** | **97äººæ—¥** |

---

## âš ï¸ å®Ÿè£…å„ªå…ˆåº¦

```
Phase 1 (Enterprise Tier Launch)
  â”œâ”€â”€ SAML 2.0 SSO â˜…â˜…â˜…
  â”œâ”€â”€ IPåˆ¶é™ â˜…â˜…â˜…
  â””â”€â”€ ç›£æŸ»ãƒ­ã‚°å¼·åŒ– â˜…â˜…â˜…

Phase 2 (é«˜ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é¡§å®¢å¯¾å¿œ)
  â”œâ”€â”€ SCIM Provisioning â˜…â˜…â˜†
  â”œâ”€â”€ ãƒ›ãƒ¯ã‚¤ãƒˆãƒ©ãƒ™ãƒªãƒ³ã‚°ï¼ˆåŸºæœ¬ï¼‰ â˜…â˜…â˜†
  â””â”€â”€ OIDC SSO â˜…â˜…â˜†

Phase 3 (ã‚°ãƒ­ãƒ¼ãƒãƒ«å±•é–‹)
  â”œâ”€â”€ ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¸ãƒ‡ãƒ³ã‚·ãƒ¼ â˜…â˜†â˜†
  â”œâ”€â”€ VPNé€£æº â˜…â˜†â˜†
  â””â”€â”€ ãƒ›ãƒ¯ã‚¤ãƒˆãƒ©ãƒ™ãƒªãƒ³ã‚°ï¼ˆå®Œå…¨ï¼‰ â˜…â˜†â˜†
```

---

*[MUSTæ©Ÿèƒ½ä¸€è¦§ã«æˆ»ã‚‹](../MUST/00_overview.md) | [WANTæ©Ÿèƒ½æ¦‚è¦ã«æˆ»ã‚‹](./00_overview.md)*
