# ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  é³¥ç°å›³

**ä½œæˆæ—¥:** 2025å¹´11æœˆ28æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 1.0  
**å¯¾è±¡:** mirelplatform çµ±åˆãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç†åŸºç›¤

---

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

mirelplatform ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã¯ã€**ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆ SaaS ç’°å¢ƒ**ã«ãŠã‘ã‚‹æŸ”è»Ÿã§å …ç‰¢ãªãƒ©ã‚¤ã‚»ãƒ³ã‚¹åˆ¶å¾¡ã‚’å®Ÿç¾ã™ã‚‹çµ±åˆåŸºç›¤ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼å˜ä½ãƒ»ãƒ†ãƒŠãƒ³ãƒˆå˜ä½ã®ä¸¡æ–¹ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’ç®¡ç†ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã€èª²é‡‘é€£æºã€ç›£æŸ»ãƒ­ã‚°ã®çµ±åˆã‚’æä¾›ã—ã¾ã™ã€‚

### ä¸»è¦æ©Ÿèƒ½
- **éšå±¤çš„ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç†**: USER / TENANT ã‚¹ã‚³ãƒ¼ãƒ—ã§ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ä»˜ä¸
- **ãƒ†ã‚£ã‚¢åˆ¶å¾¡**: FREE, TRIAL, PRO, MAX ã®4æ®µéšãƒ©ã‚¤ã‚»ãƒ³ã‚¹
- **ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°çµ±åˆ**: æ©Ÿèƒ½å˜ä½ã®è©³ç´°ãªã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- **æœ‰åŠ¹æœŸé™ç®¡ç†**: TRIAL ã®è‡ªå‹•æœŸé™åˆ‡ã‚Œã€PRO/MAX ã®å¥‘ç´„æ›´æ–°ç®¡ç†
- **ç›£æŸ»ãƒ­ã‚°**: ã™ã¹ã¦ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æ“ä½œã‚’è¨˜éŒ²
- **èª²é‡‘ã‚·ã‚¹ãƒ†ãƒ é€£æº**: å°†æ¥çš„ãª Stripe / PayPal ç­‰ã¨ã®çµ±åˆã‚’è€ƒæ…®ã—ãŸè¨­è¨ˆ

---

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å…¨ä½“å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Frontend (React 19)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  User Dashboardâ”‚  Admin Console   â”‚  Billing Portal  â”‚  Feature UI   â”‚
â”‚  - My Licenses â”‚  - User Mgmt     â”‚  - Upgrade Plans â”‚  - Conditionalâ”‚
â”‚  - Features    â”‚  - License Mgmt  â”‚  - Payment Hist  â”‚    Display    â”‚
â”‚  - Upgrade CTA â”‚  - Tenant Mgmt   â”‚  - Invoice DL    â”‚  - Lock Icons â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â–¼ HTTPS/REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Gateway / Spring Security                     â”‚
â”‚  - JWT Authentication                                                â”‚
â”‚  - Rate Limiting (License Tieråˆ¥)                                   â”‚
â”‚  - CORS, CSRF Protection                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ExecutionContext (Request Scope)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Current User, Tenant, Effective Licenses, Feature Flags       â”‚ â”‚
â”‚  â”‚ - hasLicense(app, tier): boolean                              â”‚ â”‚
â”‚  â”‚ - hasFeature(featureKey): boolean                             â”‚ â”‚
â”‚  â”‚ - getEffectiveLicenses(): List<ApplicationLicense>            â”‚ â”‚
â”‚  â”‚ - resolveStrategy: TENANT_PRIORITY / USER_PRIORITY / EITHER   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Service Layer (Business Logic)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ LicenseService â”‚FeatureFlagServiceâ”‚ BillingService   â”‚ AuditService  â”‚
â”‚ - Grant        â”‚ - CRUD           â”‚ - Create Sub     â”‚ - Record      â”‚
â”‚ - Revoke       â”‚ - Evaluate       â”‚ - Cancel Sub     â”‚ - Query       â”‚
â”‚ - Upgrade      â”‚ - Toggle         â”‚ - Invoice Gen    â”‚ - Export      â”‚
â”‚ - Downgrade    â”‚ - A/B Test (å°†æ¥)â”‚ - Payment Webhookâ”‚ - Compliance  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Data Access Layer (JPA)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ApplicationLic â”‚ FeatureFlag      â”‚ Subscription     â”‚ AuditLog      â”‚
â”‚ enseRepository â”‚ Repository       â”‚ Repository       â”‚ Repository    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Database (PostgreSQL / H2)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ mir_application_ â”‚  â”‚ mir_feature_flag â”‚  â”‚ mir_subscription  â”‚ â”‚
â”‚  â”‚ license          â”‚  â”‚                  â”‚  â”‚                   â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ mir_audit_log    â”‚  â”‚ mir_user         â”‚  â”‚ mir_tenant        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â–²
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                         â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  External Billingâ”‚      â”‚  Analytics &     â”‚
          â”‚  Provider (å°†æ¥) â”‚      â”‚  Monitoring      â”‚
          â”‚  - Stripe        â”‚      â”‚  - Prometheus    â”‚
          â”‚  - PayPal        â”‚      â”‚  - Grafana       â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è©³ç´°

### 3.1 ã‚³ã‚¢ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£

```sql
-- ApplicationLicense (æ—¢å­˜)
CREATE TABLE mir_application_license (
    id VARCHAR(36) PRIMARY KEY,
    subject_type VARCHAR(20) NOT NULL,  -- USER / TENANT
    subject_id VARCHAR(36) NOT NULL,    -- userId or tenantId
    application_id VARCHAR(50) NOT NULL,
    tier VARCHAR(20) NOT NULL,          -- FREE, TRIAL, PRO, MAX
    features TEXT,                       -- JSON: æœ‰åŠ¹æ©Ÿèƒ½ãƒªã‚¹ãƒˆ (å°†æ¥æ‹¡å¼µ)
    granted_at TIMESTAMP NOT NULL,
    expires_at TIMESTAMP,                -- TRIAL/PRO/MAX ã®æœŸé™
    granted_by VARCHAR(36),
    auto_renew BOOLEAN DEFAULT FALSE,    -- è‡ªå‹•æ›´æ–°ãƒ•ãƒ©ã‚° (å°†æ¥)
    billing_cycle VARCHAR(20),           -- MONTHLY, YEARLY (å°†æ¥)
    INDEX idx_license_subject (subject_type, subject_id, application_id),
    INDEX idx_license_expires (expires_at)
);

-- FeatureFlag (æ–°è¦)
CREATE TABLE mir_feature_flag (
    id VARCHAR(36) PRIMARY KEY,
    feature_key VARCHAR(100) NOT NULL UNIQUE,
    feature_name VARCHAR(200) NOT NULL,
    description TEXT,
    application_id VARCHAR(50) NOT NULL,
    status VARCHAR(20) NOT NULL,        -- STABLE, BETA, ALPHA, PLANNING, DEPRECATED
    in_development BOOLEAN DEFAULT FALSE,
    required_license_tier VARCHAR(20),  -- FREE, TRIAL, PRO, MAX, NULL
    enabled_by_default BOOLEAN DEFAULT TRUE,
    enabled_for_user_ids TEXT,          -- JSON: ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿æœ‰åŠ¹åŒ–
    enabled_for_tenant_ids TEXT,        -- JSON: ç‰¹å®šãƒ†ãƒŠãƒ³ãƒˆã®ã¿æœ‰åŠ¹åŒ–
    rollout_percentage INT DEFAULT 100, -- ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ç”¨ (å°†æ¥)
    metadata TEXT,                       -- JSON: æ‹¡å¼µè¨­å®š
    INDEX idx_ff_application (application_id),
    INDEX idx_ff_status (status)
);

-- Subscription (å°†æ¥æ‹¡å¼µ)
CREATE TABLE mir_subscription (
    id VARCHAR(36) PRIMARY KEY,
    license_id VARCHAR(36) NOT NULL,    -- ApplicationLicense.id
    external_subscription_id VARCHAR(100), -- Stripe Subscription IDç­‰
    status VARCHAR(20) NOT NULL,        -- ACTIVE, PAST_DUE, CANCELED, TRIALING
    billing_cycle VARCHAR(20),          -- MONTHLY, YEARLY
    current_period_start TIMESTAMP,
    current_period_end TIMESTAMP,
    cancel_at_period_end BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP,
    FOREIGN KEY (license_id) REFERENCES mir_application_license(id)
);

-- BillingHistory (å°†æ¥æ‹¡å¼µ)
CREATE TABLE mir_billing_history (
    id VARCHAR(36) PRIMARY KEY,
    subscription_id VARCHAR(36),
    invoice_id VARCHAR(100),
    amount DECIMAL(10, 2),
    currency VARCHAR(3) DEFAULT 'JPY',
    status VARCHAR(20),                 -- PAID, PENDING, FAILED
    billing_date TIMESTAMP,
    payment_method VARCHAR(50),
    FOREIGN KEY (subscription_id) REFERENCES mir_subscription(id)
);
```

### 3.2 ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£é–¢é€£å›³

```
User â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”œâ”€â”€< ApplicationLicense >â”€â”€â”€â”
Tenant â”€â”€â”€â”€â”€â”€â”˜                           â”‚
                                         â”œâ”€â”€< Subscription (å°†æ¥)
FeatureFlag â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             (requiredLicenseTier ã§ç´ä»˜ã‘)

ApplicationLicense â”€â”€â”€â”€< BillingHistory (å°†æ¥)
```

---

## 4. ãƒ©ã‚¤ã‚»ãƒ³ã‚¹åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯

### 4.1 ExecutionContext ã«ã‚ˆã‚‹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹è§£æ±º

```java
/**
 * ãƒ©ã‚¤ã‚»ãƒ³ã‚¹åˆ¤å®šæˆ¦ç•¥
 */
public enum LicenseResolveStrategy {
    TENANT_PRIORITY,  // ãƒ†ãƒŠãƒ³ãƒˆãƒ©ã‚¤ã‚»ãƒ³ã‚¹å„ªå…ˆã€ãªã‘ã‚Œã°ãƒ¦ãƒ¼ã‚¶ãƒ¼ (æ¨å¥¨)
    USER_PRIORITY,    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å„ªå…ˆã€ãªã‘ã‚Œã°ãƒ†ãƒŠãƒ³ãƒˆ
    TENANT_ONLY,      // ãƒ†ãƒŠãƒ³ãƒˆãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ã¿ (B2B å³æ ¼ãƒ¢ãƒ¼ãƒ‰)
    USER_ONLY,        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ã¿ (å€‹äººå‘ã‘)
    EITHER,           // ã©ã¡ã‚‰ã‹ä¸€æ–¹ (ç¾åœ¨ã®å®Ÿè£…)
    BOTH_REQUIRED     // ä¸¡æ–¹å¿…è¦ (è¶…ã‚»ã‚­ãƒ¥ã‚¢æ©Ÿèƒ½å‘ã‘)
}

/**
 * ExecutionContext æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰
 */
public boolean hasLicense(String applicationId, LicenseTier tier, LicenseResolveStrategy strategy) {
    switch (strategy) {
        case TENANT_PRIORITY:
            // 1. ãƒ†ãƒŠãƒ³ãƒˆãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯
            Optional<ApplicationLicense> tenantLicense = effectiveLicenses.stream()
                .filter(l -> l.getSubjectType() == SubjectType.TENANT)
                .filter(l -> l.getApplicationId().equals(applicationId))
                .filter(l -> l.getTier().ordinal() >= tier.ordinal())
                .filter(l -> isNotExpired(l))
                .findFirst();
            
            if (tenantLicense.isPresent()) return true;
            
            // 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯
            return effectiveLicenses.stream()
                .filter(l -> l.getSubjectType() == SubjectType.USER)
                .filter(l -> l.getApplicationId().equals(applicationId))
                .filter(l -> l.getTier().ordinal() >= tier.ordinal())
                .filter(l -> isNotExpired(l))
                .findAny()
                .isPresent();
        
        case TENANT_ONLY:
            // ãƒ†ãƒŠãƒ³ãƒˆãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ã¿
            // ... (å®Ÿè£…ç•¥)
        
        // ä»–ã®æˆ¦ç•¥ã‚‚åŒæ§˜ã«å®Ÿè£…
    }
}

/**
 * ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°çµ±åˆåˆ¤å®š
 */
public boolean hasFeature(String featureKey, LicenseResolveStrategy strategy) {
    FeatureFlag feature = featureFlagRepository.findByFeatureKey(featureKey)
        .orElseThrow(() -> new FeatureNotFoundException(featureKey));
    
    // 1. é–‹ç™ºä¸­ãƒ•ãƒ©ã‚°ãƒã‚§ãƒƒã‚¯
    if (feature.getInDevelopment() && !isDevEnvironment()) {
        return false;
    }
    
    // 2. ãƒ©ã‚¤ã‚»ãƒ³ã‚¹è¦ä»¶ãƒã‚§ãƒƒã‚¯
    if (feature.getRequiredLicenseTier() != null) {
        if (!hasLicense(feature.getApplicationId(), feature.getRequiredLicenseTier(), strategy)) {
            return false;
        }
    }
    
    // 3. å€‹åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ãƒ†ãƒŠãƒ³ãƒˆæœ‰åŠ¹åŒ–ãƒã‚§ãƒƒã‚¯
    if (feature.getEnabledForUserIds() != null) {
        List<String> enabledUsers = parseJson(feature.getEnabledForUserIds());
        if (!enabledUsers.isEmpty() && !enabledUsers.contains(getCurrentUserId())) {
            return false;
        }
    }
    
    // 4. ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ãƒã‚§ãƒƒã‚¯ (å°†æ¥)
    if (feature.getRolloutPercentage() < 100) {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã®ãƒãƒƒã‚·ãƒ¥å€¤ã§åˆ¤å®š
        // return (hash(getCurrentUserId()) % 100) < feature.getRolloutPercentage();
    }
    
    return feature.getEnabledByDefault();
}
```

### 4.2 AOP ã«ã‚ˆã‚‹è‡ªå‹•ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯

```java
/**
 * @RequireLicense ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ (æ—¢å­˜)
 */
@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
public @interface RequireLicense {
    String application();
    LicenseTier tier() default LicenseTier.FREE;
    LicenseResolveStrategy strategy() default LicenseResolveStrategy.TENANT_PRIORITY;
}

/**
 * @RequireFeature ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ (æ–°è¦)
 */
@Target({ElementType.METHOD, ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
public @interface RequireFeature {
    String featureKey();
    LicenseResolveStrategy strategy() default LicenseResolveStrategy.TENANT_PRIORITY;
}

/**
 * LicenseCheckAspect (æ—¢å­˜) + FeatureCheckAspect (æ–°è¦)
 */
@Aspect
@Component
public class AccessControlAspect {
    
    @Before("@annotation(requireLicense)")
    public void checkLicense(JoinPoint joinPoint, RequireLicense requireLicense) {
        if (!executionContext.hasLicense(
                requireLicense.application(), 
                requireLicense.tier(), 
                requireLicense.strategy())) {
            throw new LicenseRequiredException(requireLicense.application(), requireLicense.tier());
        }
    }
    
    @Before("@annotation(requireFeature)")
    public void checkFeature(JoinPoint joinPoint, RequireFeature requireFeature) {
        if (!executionContext.hasFeature(
                requireFeature.featureKey(), 
                requireFeature.strategy())) {
            throw new FeatureNotEnabledException(requireFeature.featureKey());
        }
    }
}
```

---

## 5. ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç† API

### 5.1 ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ API

```yaml
# ç¾åœ¨ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æƒ…å ±å–å¾—
GET /users/me/licenses
Response:
  licenses: ApplicationLicense[]
  features: FeatureFlag[]
  upgradeRecommendations: UpgradeOption[]

# åˆ©ç”¨å¯èƒ½æ©Ÿèƒ½ä¸€è¦§
GET /features/available
Response:
  features: FeatureFlag[]
  grouped_by_application: Map<String, FeatureFlag[]>

# ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰è¦‹ç©ã‚‚ã‚Š
POST /billing/upgrade/estimate
Request:
  targetTier: PRO | MAX
  billingCycle: MONTHLY | YEARLY
Response:
  monthlyPrice: number
  annualPrice: number
  savings: number
  featuresGained: string[]
```

### 5.2 ç®¡ç†è€…å‘ã‘ API

```yaml
# ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ä¸€è¦§å–å¾—
GET /admin/licenses
Query:
  - subjectType: USER | TENANT
  - applicationId: string
  - tier: FREE | TRIAL | PRO | MAX
  - expiringSoon: boolean (30æ—¥ä»¥å†…ã«æœŸé™åˆ‡ã‚Œ)
  - page, size
Response:
  content: ApplicationLicense[]
  totalElements: number

# ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ä»˜ä¸
POST /admin/licenses/grant
Request:
  subjectType: USER | TENANT
  subjectId: UUID
  applicationId: string
  tier: FREE | TRIAL | PRO | MAX
  expiresAt: timestamp (TRIAL/PRO/MAX ã®å ´åˆå¿…é ˆ)
  grantReason: string
Response:
  license: ApplicationLicense

# ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å–æ¶ˆ
DELETE /admin/licenses/{id}
Query:
  - reason: string
  - notifyUser: boolean

# ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ç®¡ç†
GET/POST/PUT/DELETE /admin/features/**
(feature-flag-management-plan.md å‚ç…§)
```

### 5.3 èª²é‡‘é€£æº API (å°†æ¥æ‹¡å¼µ)

```yaml
# Stripe Webhook
POST /billing/webhooks/stripe
Request: (Stripe Event Object)
Handlers:
  - checkout.session.completed â†’ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ä»˜ä¸
  - invoice.payment_succeeded â†’ æ”¯æ‰•ã„è¨˜éŒ²
  - invoice.payment_failed â†’ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ä¸€æ™‚åœæ­¢
  - customer.subscription.deleted â†’ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å–æ¶ˆ

# ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ä½œæˆ
POST /billing/subscriptions
Request:
  applicationId: string
  tier: PRO | MAX
  billingCycle: MONTHLY | YEARLY
  paymentMethodId: string (Stripe Payment Method ID)
Response:
  subscription: Subscription
  clientSecret: string (Stripe Checkoutç”¨)

# ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚­ãƒ£ãƒ³ã‚»ãƒ«
DELETE /billing/subscriptions/{id}
Query:
  - cancelAtPeriodEnd: boolean (å³æ™‚ or æœŸæœ«)
```

---

## 6. é‹ç”¨ã‚·ãƒŠãƒªã‚ª

### 6.1 ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ â”‚ â†’ è‡ªå‹•çš„ã« FREE ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ä»˜ä¸
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         (signupæ™‚)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TRIAL é–‹å§‹  â”‚ â† ç®¡ç†è€…ä»˜ä¸ or ã‚»ãƒ«ãƒ•ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ (14æ—¥é–“)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ æœŸé™å†…ã«æœ‰æ–™ãƒ—ãƒ©ãƒ³å¥‘ç´„ â†’ PRO/MAX ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ä»˜ä¸
       â”‚
       â””â”€ æœŸé™åˆ‡ã‚Œ â†’ è‡ªå‹•çš„ã« FREE ã«ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰
                     (GracePeriod: 3æ—¥é–“ã¯ PRO æ©Ÿèƒ½ç¶™ç¶š)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PRO / MAX   â”‚ â† ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³é–‹å§‹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ è‡ªå‹•æ›´æ–°æˆåŠŸ â†’ ç¶™ç¶š
       â”‚
       â”œâ”€ æ”¯æ‰•ã„å¤±æ•— â†’ PAST_DUE (7æ—¥é–“çŒ¶äºˆ)
       â”‚                  â”œâ”€ å†è©¦è¡ŒæˆåŠŸ â†’ å¾©æ´»
       â”‚                  â””â”€ å¤±æ•—ç¶™ç¶š â†’ SUSPENDED â†’ FREE
       â”‚
       â””â”€ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ« â†’ æœŸæœ«ã¾ã§ç¶™ç¶š â†’ FREE
```

### 6.2 TRIAL ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®è‡ªå‹•ç®¡ç†

**ãƒãƒƒãƒã‚¸ãƒ§ãƒ–å®Ÿè£… (Spring Scheduler):**

```java
@Scheduled(cron = "0 0 2 * * *") // æ¯æ—¥åˆå‰2æ™‚å®Ÿè¡Œ
public void expireTrialLicenses() {
    Instant now = Instant.now();
    Instant gracePeriodEnd = now.minusSeconds(3 * 24 * 3600); // 3æ—¥å‰
    
    List<ApplicationLicense> expiredTrials = licenseRepository.findExpiredTrials(gracePeriodEnd);
    
    for (ApplicationLicense license : expiredTrials) {
        // 1. FREE ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã«è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆ
        ApplicationLicense freeLicense = createFreeLicense(license);
        licenseRepository.save(freeLicense);
        
        // 2. TRIAL ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’è«–ç†å‰Šé™¤
        license.setDeleteFlag(true);
        licenseRepository.save(license);
        
        // 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ãƒ¡ãƒ¼ãƒ«é€ä¿¡
        emailService.sendTrialExpiredNotification(license);
        
        // 4. ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²
        auditLog.record("LICENSE_EXPIRED", license, "TRIAL expired, downgraded to FREE");
    }
}
```

### 6.3 ãƒ†ãƒŠãƒ³ãƒˆå˜ä½ãƒ©ã‚¤ã‚»ãƒ³ã‚¹é‹ç”¨

**ä¼æ¥­å¥‘ç´„ (B2B) ãƒ‘ã‚¿ãƒ¼ãƒ³:**

```
ä¼æ¥­A (Tenant: enterprise-001)
  â”œâ”€ Tenant License: ProMarker MAX (å…¨ç¤¾å“¡ãŒåˆ©ç”¨å¯èƒ½)
  â””â”€ Users:
      â”œâ”€ user-001 (OWNER) â†’ MAX åˆ©ç”¨å¯èƒ½
      â”œâ”€ user-002 (MEMBER) â†’ MAX åˆ©ç”¨å¯èƒ½
      â””â”€ user-003 (GUEST) â†’ FREE ã®ã¿ (ã‚²ã‚¹ãƒˆã¯ãƒ†ãƒŠãƒ³ãƒˆãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’ç¶™æ‰¿ã—ãªã„)

åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ (TENANT_PRIORITY):
  1. user-001, user-002 â†’ ãƒ†ãƒŠãƒ³ãƒˆã® MAX ãƒ©ã‚¤ã‚»ãƒ³ã‚¹é©ç”¨
  2. user-003 â†’ ã‚²ã‚¹ãƒˆãªã®ã§ãƒ†ãƒŠãƒ³ãƒˆãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç„¡åŠ¹ã€å€‹äººã® FREE ã®ã¿
```

**ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹ (å€‹äºº) ãƒ‘ã‚¿ãƒ¼ãƒ³:**

```
User: freelance-user-001
  â”œâ”€ User License: ProMarker PRO
  â””â”€ Tenants:
      â”œâ”€ personal-workspace (è‡ªåˆ†ã®ãƒ†ãƒŠãƒ³ãƒˆ) â†’ PRO ç¶™æ‰¿
      â”œâ”€ client-a-workspace (ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆA, FREE) â†’ PRO ç¶™æ‰¿ (USER_PRIORITY)
      â””â”€ client-b-workspace (ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆB, MAX) â†’ MAX é©ç”¨ (TENANTå„ªå…ˆ)

åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ (TENANT_PRIORITY):
  - personal-workspace: ãƒ¦ãƒ¼ã‚¶ãƒ¼ PRO
  - client-a-workspace: ãƒ¦ãƒ¼ã‚¶ãƒ¼ PRO (ãƒ†ãƒŠãƒ³ãƒˆ FREE ã‚ˆã‚Šå„ªå…ˆ)
  - client-b-workspace: ãƒ†ãƒŠãƒ³ãƒˆ MAX (ãƒ¦ãƒ¼ã‚¶ãƒ¼ PRO ã‚ˆã‚Šé«˜ã„)
```

---

## 7. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹

### 7.1 ç›£æŸ»ãƒ­ã‚°

ã™ã¹ã¦ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æ“ä½œã‚’ `mir_audit_log` ã«è¨˜éŒ²:

```sql
INSERT INTO mir_audit_log (
    user_id, tenant_id, event_type, resource_type, resource_id, 
    metadata, ip_address, user_agent
) VALUES (
    'admin-001', 'default', 'LICENSE_GRANTED', 'ApplicationLicense', 'license-123',
    '{"tier": "PRO", "application": "promarker", "grantedTo": "user-456"}',
    '192.168.1.100', 'Mozilla/5.0...'
);
```

### 7.2 ä¸æ­£åˆ©ç”¨é˜²æ­¢

- **Rate Limiting**: ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒ†ã‚£ã‚¢åˆ¥ã« API ãƒ¬ãƒ¼ãƒˆåˆ¶é™
  - FREE: 100 req/hour
  - TRIAL: 500 req/hour
  - PRO: 2000 req/hour
  - MAX: 10000 req/hour
- **IP Whitelist**: MAX ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã§ä¼æ¥­IPã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã®ã¿è¨±å¯ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
- **Device Limit**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¯æœ€å¤§5ãƒ‡ãƒã‚¤ã‚¹ã¾ã§ (RefreshToken ã§ç®¡ç†)

### 7.3 GDPR å¯¾å¿œ

- ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æƒ…å ±ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ (`GET /users/me/data-export`)
- ãƒ©ã‚¤ã‚»ãƒ³ã‚¹å±¥æ­´ã®å‰Šé™¤ (ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤æ™‚ã€è«–ç†å‰Šé™¤ â†’ ç‰©ç†å‰Šé™¤)

---

## 8. å°†æ¥æ‹¡å¼µè¨ˆç”»

### Phase 1 (ç¾åœ¨): åŸºæœ¬ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç†
- âœ… ApplicationLicense ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
- âœ… ExecutionContext ã«ã‚ˆã‚‹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹åˆ¤å®š
- âœ… @RequireLicense AOP
- ğŸ”„ FeatureFlag ã‚·ã‚¹ãƒ†ãƒ  (æœ¬è¨ˆç”»æ›¸)
- ğŸ”„ ç®¡ç†ç”»é¢ (ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ CRUD)

### Phase 2: èª²é‡‘é€£æº
- Stripe çµ±åˆ (ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã€æ”¯æ‰•ã„)
- Subscription ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å®Ÿè£…
- è‡ªå‹•æ›´æ–°ãƒ»è«‹æ±‚æ›¸ç”Ÿæˆ
- æ”¯æ‰•ã„å¤±æ•—æ™‚ã®ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ”ãƒªã‚ªãƒ‰å‡¦ç†

### Phase 3: é«˜åº¦ãªæ©Ÿèƒ½
- A/B ãƒ†ã‚¹ãƒˆ (FeatureFlag ã® rolloutPercentage æ´»ç”¨)
- ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹ (ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ç¾¤ã¸ã®æ®µéšçš„ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ)
- Usage-based Billing (API å‘¼ã³å‡ºã—å›æ•°ã«å¿œã˜ãŸå¾“é‡èª²é‡‘)
- ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚«ã‚¹ã‚¿ãƒ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ (ç‰¹å®šæ©Ÿèƒ½ã®ã¿ã®å€‹åˆ¥å¥‘ç´„)

### Phase 4: åˆ†æãƒ»æœ€é©åŒ–
- ãƒ©ã‚¤ã‚»ãƒ³ã‚¹åˆ©ç”¨çŠ¶æ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ (Grafana)
- ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰äºˆæ¸¬ (æ©Ÿæ¢°å­¦ç¿’)
- ãƒãƒ£ãƒ¼ãƒ³åˆ†æ (è§£ç´„ç‡åˆ†æ)
- ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æœ€é©åŒ–

---

## 9. å‚è€ƒè³‡æ–™

- **æ—¢å­˜å®Ÿè£…:** 
  - `ApplicationLicense.java` - [backend/src/main/java/.../entity/ApplicationLicense.java](../../backend/src/main/java/jp/vemi/mirel/foundation/abst/dao/entity/ApplicationLicense.java)
  - `ExecutionContext.java` - [backend/src/main/java/.../context/ExecutionContext.java](../../backend/src/main/java/jp/vemi/mirel/foundation/context/ExecutionContext.java)
  - `@RequireLicense` - [backend/src/main/java/.../license/RequireLicense.java](../../backend/src/main/java/jp/vemi/mirel/foundation/security/license/RequireLicense.java)

- **é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:**
  - [SaaSå¯¾å¿œè¨ˆç”».md](../docs/issue/#39/SaaSå¯¾å¿œè¨ˆç”».md)
  - [feature-flag-management-plan.md](./feature-flag-management-plan.md)

- **å¤–éƒ¨å‚è€ƒ:**
  - [Stripe Subscription API](https://stripe.com/docs/api/subscriptions)
  - [LaunchDarkly Feature Flags](https://docs.launchdarkly.com/)
  - [Auth0 RBAC Best Practices](https://auth0.com/docs/manage-users/access-control/rbac)

---

**ä½œæˆè€…:** GitHub Copilot ğŸ¤–  
**ãƒ¬ãƒ“ãƒ¥ãƒ¼çŠ¶æ…‹:** Draft  
**æ¬¡å›æ›´æ–°äºˆå®š:** Phase 2 å®Ÿè£…é–‹å§‹æ™‚ (2025å¹´Q1äºˆå®š)
