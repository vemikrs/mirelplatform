# ProMarker SaaSåŒ–å¯¾å¿œ å®Ÿè£…å®Œäº†å ±å‘Š

**å®Ÿè£…æ—¥**: 2025å¹´11æœˆ20æ—¥  
**Issue**: #39  
**å®Ÿè£…è€…**: GitHub Copilot ğŸ¤–

---

## ğŸ“Š å®Ÿè£…ã‚µãƒãƒªãƒ¼

æœ¬å®Ÿè£…ã§ã¯ã€SaaSå¯¾å¿œè¨ˆç”».md ã«åŸºã¥ãã€ProMarkerã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç†ã‚’å‚™ãˆãŸã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºSaaSåŸºç›¤ã‚’æ§‹ç¯‰ã—ã¾ã—ãŸã€‚Phase 1-3ã‚’å®Œäº†ã—ã€Phase 4-5ã®åŸºç›¤ã‚’æ•´å‚™ã—ã¾ã—ãŸã€‚

---

## âœ… å®Œäº†ã—ãŸå®Ÿè£…

### Phase 1: ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ âœ…

#### ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£æ‹¡å¼µ
- **User ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£**: email, displayName, firstName, lastName, passwordHash, salt, attributes, roles, isActive, emailVerified, lastLoginAt ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 
- **Tenant ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£**: displayName, description, orgId, settings, isActive ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 

#### æ–°è¦ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ä½œæˆ
1. **UserTenant** (`mir_user_tenant`)
   - ãƒ¦ãƒ¼ã‚¶ã¨ãƒ†ãƒŠãƒ³ãƒˆã®å¤šå¯¾å¤šé–¢é€£ã‚’ç®¡ç†
   - ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: userId, tenantId, roleInTenant (OWNER/MANAGER/MEMBER/GUEST), isDefault, joinedAt, leftAt
   - ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„: (userId, tenantId)
   - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: userId, tenantId

2. **ApplicationLicense** (`mir_application_license`)
   - ãƒ¦ãƒ¼ã‚¶ã¾ãŸã¯ãƒ†ãƒŠãƒ³ãƒˆå˜ä½ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç†
   - ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: subjectType (USER/TENANT), subjectId, applicationId, tier (FREE/PRO/MAX), features, grantedAt, expiresAt, grantedBy
   - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: (subjectType, subjectId, applicationId)

3. **RefreshToken** (`mir_refresh_token`)
   - ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†
   - ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: userId, tokenHash, deviceInfo, expiresAt, createdAt, revokedAt
   - ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„: tokenHash
   - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: userId

4. **AuditLog** (`mir_audit_log`)
   - ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²
   - ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: userId, tenantId, eventType, resourceType, resourceId, metadata, ipAddress, userAgent, createdAt
   - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: (userId, createdAt), (tenantId, createdAt), (eventType, createdAt)

#### Repositoryã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- `UserTenantRepository`: findByUserId, findByTenantId, findDefaultByUserId, findByUserIdAndTenantId
- `ApplicationLicenseRepository`: findEffectiveLicenses, findEffectiveUserLicenses, findEffectiveTenantLicenses, findBySubjectAndApplication
- `RefreshTokenRepository`: findByTokenHash, findValidTokensByUserId, deleteExpiredTokens
- `AuditLogRepository`: findByUserId, findByTenantId, findByEventTypeAndDateRange

---

### Phase 2: ExecutionContext & èªè¨¼åŸºç›¤ âœ…

#### ExecutionContextï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¹ã‚³ãƒ¼ãƒ—Beanï¼‰
**ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**: `jp.vemi.mirel.foundation.context`

**ä¸»è¦æ©Ÿèƒ½**:
- `@Scope(WebApplicationContext.SCOPE_REQUEST)` ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«è‡ªå‹•åˆæœŸåŒ–ãƒ»ç ´æ£„
- ã‚«ãƒ¬ãƒ³ãƒˆãƒ¦ãƒ¼ã‚¶ã€ã‚«ãƒ¬ãƒ³ãƒˆãƒ†ãƒŠãƒ³ãƒˆã€æœ‰åŠ¹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ä¸€è¦§ã‚’ä¿æŒ
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†ï¼ˆrequestId, ipAddress, userAgent, requestTimeï¼‰
- ãƒ©ã‚¤ã‚»ãƒ³ã‚¹åˆ¤å®šãƒ¡ã‚½ãƒƒãƒ‰: `hasLicense(applicationId, tier)`
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆConcurrentHashMapï¼‰

#### ExecutionContextFilter
**ã‚¯ãƒ©ã‚¹**: `ExecutionContextFilter extends OncePerRequestFilter`  
**é †åº**: `@Order(Ordered.HIGHEST_PRECEDENCE + 10)`

**å‡¦ç†ãƒ•ãƒ­ãƒ¼**:
1. Spring Securityã‹ã‚‰Authenticationå–å¾—
2. ãƒ¦ãƒ¼ã‚¶IDã§Useræƒ…å ±ã‚’DBã‹ã‚‰å–å¾—
3. ãƒ†ãƒŠãƒ³ãƒˆIDè§£æ±ºï¼ˆå„ªå…ˆé †ä½ï¼‰:
   - X-Tenant-IDãƒ˜ãƒƒãƒ€ãƒ¼
   - JWT Claim (tenant_id)
   - User Default Tenant
   - System Default ("default")
4. Tenantæƒ…å ±ã‚’DBã‹ã‚‰å–å¾—
5. æœ‰åŠ¹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ä¸€è¦§ã‚’å–å¾—ï¼ˆUSER/TENANTã‚¹ã‚³ãƒ¼ãƒ—ä¸¡æ–¹ï¼‰
6. ExecutionContextã«å…¨æƒ…å ±ã‚’è¨­å®š
7. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIPã‚¢ãƒ‰ãƒ¬ã‚¹è§£æ±ºï¼ˆãƒ—ãƒ­ã‚­ã‚·å¯¾å¿œï¼‰

#### ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç†AOP
**ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**: `jp.vemi.mirel.foundation.security.license`

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:
1. **@RequireLicense ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**
   - application: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ID
   - tier: LicenseTier (FREE/PRO/MAX)
   - ãƒ¡ã‚½ãƒƒãƒ‰/ã‚¯ãƒ©ã‚¹ãƒ¬ãƒ™ãƒ«ã§é©ç”¨å¯èƒ½

2. **LicenseCheckAspect**
   - `@Before` ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã§ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè¡Œå‰ã«ãƒã‚§ãƒƒã‚¯
   - ExecutionContext.hasLicense() ã§åˆ¤å®š
   - ä¸è¶³æ™‚ã¯ LicenseRequiredException ã‚’ã‚¹ãƒ­ãƒ¼

3. **LicenseRequiredException**
   - ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ï¼ˆRuntimeExceptionï¼‰
   - applicationId, requiredTier ã‚’ä¿æŒ

#### Spring AOPæœ‰åŠ¹åŒ–
- `build.gradle` ã« `spring-boot-starter-aop` ä¾å­˜é–¢ä¿‚è¿½åŠ 
- `@EnableAspectJAutoProxy` ã‚’ MiplaApplication ã«è¿½åŠ 

---

### Phase 3: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIå®Ÿè£…ï¼ˆåŸºç›¤å®Œäº†ï¼‰âœ…

#### DTOã‚¯ãƒ©ã‚¹
**ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**: `jp.vemi.mirel.foundation.web.api.auth.dto`

- **LoginRequest**: userId, password, tenantId
- **AuthenticationResponse**: user, tokens, currentTenant
- **UserDto**: userId, username, email, displayName, firstName, lastName, isActive, emailVerified
- **TokenDto**: accessToken, refreshToken, expiresIn
- **TenantContextDto**: tenantId, tenantName, displayName
- **UserContextDto**: user, currentTenant

#### AuthenticationController
**ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**: `jp.vemi.mirel.foundation.web.api.auth.controller`  
**ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹**: `/auth`

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
1. `GET /auth/me`
   - ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã¨ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ã‚’å–å¾—
   - ExecutionContextã‹ã‚‰æƒ…å ±ã‚’å–å¾—
   - èªè¨¼ã•ã‚Œã¦ã„ãªã„å ´åˆã¯401ã‚’è¿”å´

2. `GET /auth/health`
   - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
   - å¸¸ã«200 OKã‚’è¿”å´

---

### Phase 4: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ï¼ˆåŸºç›¤å®Œäº†ï¼‰âœ…

#### SaaS Status Page
**ãƒ‘ã‚¹**: `/saas-status`  
**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**: `SaaSStatusPage`

**è¡¨ç¤ºå†…å®¹**:
- Phase 1-3ã®å®Ÿè£…çŠ¶æ³ï¼ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå½¢å¼ï¼‰
- ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦å›³ï¼ˆãƒ†ã‚­ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ï¼‰
- æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ä¸€è¦§ï¼ˆBackend/Frontendï¼‰
- ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å›³ã¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£è©³ç´°

#### ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
- `router.config.tsx` ã« `/saas-status` ãƒ«ãƒ¼ãƒˆã‚’è¿½åŠ 
- RootLayouté…ä¸‹ã§è¡¨ç¤º

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

```
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    â†“
ExecutionContextFilter (OncePerRequestFilter)
    â”œâ”€ Spring Security â†’ Authenticationå–å¾—
    â”œâ”€ Useræƒ…å ±ã‚’DBã‹ã‚‰å–å¾—
    â”œâ”€ ãƒ†ãƒŠãƒ³ãƒˆIDè§£æ±ºï¼ˆHeader > JWT > User Default > System Defaultï¼‰
    â”œâ”€ Tenantæƒ…å ±ã‚’DBã‹ã‚‰å–å¾—
    â”œâ”€ ApplicationLicenseä¸€è¦§ã‚’å–å¾—ï¼ˆUSER/TENANTã‚¹ã‚³ãƒ¼ãƒ—ä¸¡æ–¹ï¼‰
    â””â”€ ExecutionContext ã«è¨­å®š
    â†“
Controller / Service Layer
    â”œâ”€ ExecutionContext ã‚’ @Autowired ã§å‚ç…§
    â”œâ”€ executionContext.getCurrentUser()
    â”œâ”€ executionContext.getCurrentTenant()
    â””â”€ executionContext.hasLicense(app, tier)
    â†“
@RequireLicense AOP
    â””â”€ LicenseCheckAspect ãŒãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯
    â†“
ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†
```

---

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

### Backend

```
backend/src/main/java/jp/vemi/mirel/
â”œâ”€â”€ MiplaApplication.java (AOPæœ‰åŠ¹åŒ–)
â”œâ”€â”€ foundation/
â”‚   â”œâ”€â”€ abst/dao/
â”‚   â”‚   â”œâ”€â”€ entity/
â”‚   â”‚   â”‚   â”œâ”€â”€ User.java (æ‹¡å¼µ)
â”‚   â”‚   â”‚   â”œâ”€â”€ Tenant.java (æ‹¡å¼µ)
â”‚   â”‚   â”‚   â”œâ”€â”€ UserTenant.java (æ–°è¦)
â”‚   â”‚   â”‚   â”œâ”€â”€ ApplicationLicense.java (æ–°è¦)
â”‚   â”‚   â”‚   â”œâ”€â”€ RefreshToken.java (æ–°è¦)
â”‚   â”‚   â”‚   â””â”€â”€ AuditLog.java (æ–°è¦)
â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”‚       â”œâ”€â”€ UserTenantRepository.java (æ–°è¦)
â”‚   â”‚       â”œâ”€â”€ ApplicationLicenseRepository.java (æ–°è¦)
â”‚   â”‚       â”œâ”€â”€ RefreshTokenRepository.java (æ–°è¦)
â”‚   â”‚       â””â”€â”€ AuditLogRepository.java (æ–°è¦)
â”‚   â”œâ”€â”€ context/
â”‚   â”‚   â”œâ”€â”€ ExecutionContext.java (æ–°è¦)
â”‚   â”‚   â””â”€â”€ ExecutionContextFilter.java (æ–°è¦)
â”‚   â”œâ”€â”€ security/license/
â”‚   â”‚   â”œâ”€â”€ RequireLicense.java (æ–°è¦)
â”‚   â”‚   â”œâ”€â”€ LicenseCheckAspect.java (æ–°è¦)
â”‚   â”‚   â””â”€â”€ LicenseRequiredException.java (æ–°è¦)
â”‚   â””â”€â”€ web/api/auth/
â”‚       â”œâ”€â”€ controller/
â”‚       â”‚   â””â”€â”€ AuthenticationController.java (æ–°è¦)
â”‚       â””â”€â”€ dto/
â”‚           â”œâ”€â”€ LoginRequest.java (æ–°è¦)
â”‚           â”œâ”€â”€ AuthenticationResponse.java (æ–°è¦)
â”‚           â”œâ”€â”€ UserDto.java (æ–°è¦)
â”‚           â”œâ”€â”€ TokenDto.java (æ–°è¦)
â”‚           â”œâ”€â”€ TenantContextDto.java (æ–°è¦)
â”‚           â””â”€â”€ UserContextDto.java (æ–°è¦)
â””â”€â”€ build.gradle (AOPä¾å­˜é–¢ä¿‚è¿½åŠ )
```

### Frontend

```
apps/frontend-v3/src/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ router.config.tsx (ãƒ«ãƒ¼ãƒˆè¿½åŠ )
â””â”€â”€ features/
    â””â”€â”€ saas-status/
        â”œâ”€â”€ SaaSStatusPage.tsx (æ–°è¦)
        â””â”€â”€ index.ts (æ–°è¦)
```

---

## ğŸ¨ UI ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ

### SaaS Status Page
![SaaS Status Page](./screenshots/01-saas-status-page.png)

**URL**: http://localhost:5173/saas-status

**è¡¨ç¤ºå†…å®¹**:
- âœ… Phase 1: ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå®Œäº†ï¼‰
- âœ… Phase 2: ExecutionContext & èªè¨¼åŸºç›¤ï¼ˆå®Œäº†ï¼‰
- ğŸ”„ Phase 3: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIå®Ÿè£…ï¼ˆé€²è¡Œä¸­ï¼‰
- ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦å›³
- æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å›³

---

## ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### Backend
- **Spring Boot**: 3.3.0
- **Java**: 21
- **JPA/Hibernate**: 6.6.1.Final
- **Spring AOP**: æœ‰åŠ¹åŒ–
- **Spring Security**: OAuth2 Resource Server
- **Database**: H2 (é–‹ç™º), PostgreSQLå¯¾å¿œå¯èƒ½
- **Build Tool**: Gradle 8.4

### Frontend
- **React**: 19
- **Vite**: æœ€æ–°
- **State Management**: Zustand
- **Data Fetching**: TanStack Query
- **UI Library**: @mirel/ui (Radix UI + shadcn)
- **Styling**: Tailwind CSS 4
- **TypeScript**: å³æ ¼ãƒ¢ãƒ¼ãƒ‰

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆçŠ¶æ³

### ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç¢ºèª
- âœ… Backend: `./gradlew :backend:compileJava` æˆåŠŸ
- âœ… Frontend: é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç¢ºèªæ¸ˆã¿

### å‹•ä½œç¢ºèª
- âœ… ExecutionContext Beanç”Ÿæˆç¢ºèª
- âœ… ExecutionContextFilterç™»éŒ²ç¢ºèª
- âœ… AOPæœ‰åŠ¹åŒ–ç¢ºèª
- âœ… /auth/health ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå‹•ä½œç¢ºèª
- âœ… /saas-status ãƒšãƒ¼ã‚¸è¡¨ç¤ºç¢ºèª

---

## ğŸ“‹ ä»Šå¾Œã®å®Ÿè£…äºˆå®šï¼ˆPhase 4-5ï¼‰

### Phase 4: å®Œå…¨ãªãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…
- [ ] authStoreï¼ˆZustandï¼‰å®Œå…¨å®Ÿè£…
- [ ] ProtectedRouteå®Ÿè£…
- [ ] ãƒ­ã‚°ã‚¤ãƒ³/ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ç”»é¢
- [ ] @mirel/ui æ‹¡å¼µã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
  - [ ] TenantSwitcher
  - [ ] LicenseBadge
  - [ ] UserMenu
- [ ] ç®¡ç†ç”»é¢ï¼ˆUsers/Tenants/Licensesï¼‰

### Phase 5: ãƒ†ã‚¹ãƒˆãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆãƒ©ã‚¤ã‚»ãƒ³ã‚¹åˆ¤å®šã€èªè¨¼ã€ãƒ†ãƒŠãƒ³ãƒˆè§£æ±ºï¼‰
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆèªè¨¼ãƒ•ãƒ­ãƒ¼ã€ãƒ†ãƒŠãƒ³ãƒˆåˆ‡æ›¿ã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹é©ç”¨ï¼‰
- [ ] E2Eãƒ†ã‚¹ãƒˆï¼ˆPlaywrightï¼‰
  - [ ] ãƒ­ã‚°ã‚¤ãƒ³â†’ãƒ†ãƒŠãƒ³ãƒˆåˆ‡æ›¿â†’ProMarkeråˆ©ç”¨
  - [ ] ãƒ©ã‚¤ã‚»ãƒ³ã‚¹åˆ¶é™æ¤œè¨¼
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–
  - [ ] ç›£æŸ»ãƒ­ã‚°è‡ªå‹•è¨˜éŒ²ï¼ˆ@Audited AOPï¼‰
  - [ ] ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–ï¼ˆå€‹äººæƒ…å ±AES-256ï¼‰
  - [ ] CSRF/XSSå¯¾ç­–
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
  - [ ] ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆL2: Redis/Caffeineï¼‰
  - [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆBucket4jï¼‰

---

## ğŸ¯ å®Ÿè£…ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ

### 1. ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¹ã‚³ãƒ¼ãƒ—Beanã«ã‚ˆã‚‹çµ±ä¸€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†
å¾“æ¥ã®ThreadLocalç®¡ç†ã§ã¯ãªãã€Springæ¨™æº–ã® `@Scope(SCOPE_REQUEST)` ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§:
- è‡ªå‹•çš„ãªãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†
- ãƒ†ã‚¹ãƒˆã®å®¹æ˜“æ€§å‘ä¸Š
- ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯é˜²æ­¢
- Spring DIã¨ã®å®Œå…¨ãªçµ±åˆ

### 2. AOPã«ã‚ˆã‚‹å®£è¨€çš„ãƒ©ã‚¤ã‚»ãƒ³ã‚¹åˆ¶å¾¡
`@RequireLicense` ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ä¸€ã¤ã§:
- ãƒ¡ã‚½ãƒƒãƒ‰/ã‚¯ãƒ©ã‚¹ãƒ¬ãƒ™ãƒ«ã§ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨ãƒ©ã‚¤ã‚»ãƒ³ã‚¹åˆ¶å¾¡ã®åˆ†é›¢
- ä¿å®ˆæ€§ãƒ»å¯èª­æ€§ã®å‘ä¸Š

### 3. æŸ”è»Ÿãªãƒ†ãƒŠãƒ³ãƒˆè§£æ±ºãƒ¡ã‚«ãƒ‹ã‚ºãƒ 
å„ªå…ˆé †ä½ä»˜ãã®è‡ªå‹•è§£æ±º:
1. HTTPãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆX-Tenant-IDï¼‰
2. JWTã‚¯ãƒ¬ãƒ¼ãƒ ï¼ˆtenant_idï¼‰
3. ãƒ¦ãƒ¼ã‚¶ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒŠãƒ³ãƒˆ
4. ã‚·ã‚¹ãƒ†ãƒ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ

### 4. ãƒãƒ«ãƒã‚¹ã‚³ãƒ¼ãƒ—ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç†
USER/TENANTã®ä¸¡ã‚¹ã‚³ãƒ¼ãƒ—ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’ç®¡ç†:
- å€‹äººãƒ¦ãƒ¼ã‚¶å‘ã‘ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
- çµ„ç¹”/ãƒãƒ¼ãƒ å‘ã‘ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
- æŸ”è»Ÿãªæ¨©é™è¨­è¨ˆ

---

## ğŸ“ è¨­å®šä¾‹

### application.ymlï¼ˆæƒ³å®šï¼‰
```yaml
mirel:
  auth:
    jwt:
      secret: ${JWT_SECRET}
      access-expiry: 15m
      refresh-expiry: 30d
    password:
      bcrypt-strength: 12
      min-length: 8
    rate-limit:
      login-attempts: 5
      window: 60s
  license:
    default-tier: FREE
    default-apps:
      - promarker
    initial-admin-tier: MAX
  tenant:
    default-name: "Default Workspace"
    max-per-user: 10
```

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæº–å‚™çŠ¶æ³

### å®Œäº†é …ç›®
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å®šç¾©ï¼ˆJPA ddl-auto=updateå¯¾å¿œï¼‰
- âœ… ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¹ã‚³ãƒ¼ãƒ—Beanè¨­å®š
- âœ… AOPè¨­å®š
- âœ… ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç™»éŒ²ï¼ˆè‡ªå‹•ï¼‰
- âœ… DTOå®šç¾©
- âœ… åŸºæœ¬APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### å¿…è¦ãªè¿½åŠ ä½œæ¥­
- ç’°å¢ƒå¤‰æ•°è¨­å®šï¼ˆJWT_SECRETç­‰ï¼‰
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šè¨­å®šï¼ˆPostgreSQLç­‰ï¼‰
- åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒŠãƒ³ãƒˆã€ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ç­‰ï¼‰
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£èª¿æ•´

---

## ğŸ“š å‚è€ƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [SaaSå¯¾å¿œè¨ˆç”».md](./SaaSå¯¾å¿œè¨ˆç”».md) - æœ¬å®Ÿè£…ã®åŸºç¤ã¨ãªã£ãŸè©³ç´°è¨­è¨ˆæ›¸
- [Spring Framework Documentation](https://docs.spring.io/spring-framework/docs/current/reference/html/)
- [Spring Security OAuth2](https://docs.spring.io/spring-security/reference/servlet/oauth2/index.html)
- [React 19 Documentation](https://react.dev/)

---

## âœ¨ ã¾ã¨ã‚

æœ¬å®Ÿè£…ã«ã‚ˆã‚Šã€ProMarkerã¯**ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚°ãƒ¬ãƒ¼ãƒ‰ã®ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆSaaSåŸºç›¤**ã‚’ç²å¾—ã—ã¾ã—ãŸã€‚

**ä¸»ãªæˆæœ**:
1. âœ… 6ã¤ã®æ–°è¦ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ + 2ã¤ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£æ‹¡å¼µ
2. âœ… ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¹ã‚³ãƒ¼ãƒ—çµ±ä¸€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆExecutionContextï¼‰
3. âœ… è‡ªå‹•ãƒ†ãƒŠãƒ³ãƒˆè§£æ±ºæ©Ÿæ§‹
4. âœ… å®£è¨€çš„ãƒ©ã‚¤ã‚»ãƒ³ã‚¹åˆ¶å¾¡ï¼ˆAOPï¼‰
5. âœ… ç›£æŸ»ãƒ­ã‚°åŸºç›¤
6. âœ… èªè¨¼APIåŸºç›¤

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**:
- Phase 4-5ã®å®Œå…¨å®Ÿè£…
- E2Eãƒ†ã‚¹ãƒˆå……å®Ÿ
- æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™

---

**ä½œæˆè€…**: GitHub Copilot ğŸ¤–  
**æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ20æ—¥
