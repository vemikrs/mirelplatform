# MirelPlatform テナント管理運用ガイド

## 概要

MirelPlatformのマルチテナント運用に関するガイドです。
システム管理者およびテナント管理者向けの操作手順を説明します。

## テナント構成

### テナントタイプ

| タイプ           | 説明                                              |
| ---------------- | ------------------------------------------------- |
| システムテナント | MirelPlatform自体の管理用テナント（ID: `system`） |
| 顧客テナント     | 各顧客・組織用のテナント                          |

### テナントプラン

| プラン       | 説明             |
| ------------ | ---------------- |
| STARTER      | 小規模チーム向け |
| PROFESSIONAL | 中規模組織向け   |
| ENTERPRISE   | 大規模組織向け   |

## テナント作成

### 管理画面から作成

1. システム管理者でログイン
2. 「管理」→「プラットフォーム管理」→「テナント一覧」
3. 「新規テナント作成」ボタンをクリック
4. 以下の情報を入力：
   - テナント名
   - ドメイン
   - プラン
   - 管理者情報（ユーザー名、メールアドレス）

### API経由で作成

```bash
curl -X POST https://your-domain.com/mipla2/v1/admin/tenants \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "tenantName": "Acme Corporation",
    "domain": "acme",
    "plan": "PROFESSIONAL",
    "adminConfig": {
      "adminUsername": "admin-acme",
      "adminEmail": "admin@acme.example.com",
      "sendSetupEmail": true
    },
    "initialSettings": {
      "displayName": "Acme Corp Workspace",
      "timezone": "Asia/Tokyo",
      "locale": "ja_JP"
    }
  }'
```

## テナント管理者の追加

### 既存ユーザーを管理者に昇格

1. 「管理」→「ユーザー・権限管理」→「ユーザー管理」
2. 対象ユーザーを選択
3. 「ロール」を`TENANT_ADMIN`に変更

### 新規管理者を作成

1. 「管理」→「ユーザー・権限管理」→「ユーザー管理」
2. 「新規ユーザー作成」
3. ロールに`TENANT_ADMIN`を設定

## ロール一覧

| ロール       | 説明           | 権限                                 |
| ------------ | -------------- | ------------------------------------ |
| ADMIN        | システム管理者 | 全テナント・全機能にアクセス可能     |
| TENANT_ADMIN | テナント管理者 | 所属テナントの管理機能にアクセス可能 |
| USER         | 一般ユーザー   | 通常の業務機能のみ                   |

## UserTenant ロール

ユーザーがテナント内で持つロール：

| ロール  | 説明                         |
| ------- | ---------------------------- |
| OWNER   | テナントオーナー（削除不可） |
| ADMIN   | テナント管理者               |
| MANAGER | マネージャー                 |
| MEMBER  | 一般メンバー                 |
| GUEST   | ゲスト（読み取りのみ）       |

## テナントの停止・削除

### 停止（Suspend）

1. テナント一覧から対象テナントを選択
2. 「停止」ボタンをクリック
3. 停止中のテナントにはユーザーはアクセスできません

### 削除

> ⚠️ **注意**: テナント削除は復元できません

1. まずテナントを停止
2. 「削除」ボタンをクリック
3. 確認ダイアログで確認

## 監査ログ

テナント管理に関する操作は監査ログに記録されます：

- テナント作成
- テナント更新
- テナント停止/再開
- テナント削除
- ユーザー追加/削除
- ロール変更

## よくある質問

### Q: ユーザーを複数テナントに所属させることはできますか？

はい、可能です。ユーザーは複数のテナントに所属でき、
ログイン後にテナントを切り替えることができます。

### Q: テナントごとにストレージ容量の制限はありますか？

現在は制限機能は実装されていません。プランに応じた制限は将来実装予定です。

### Q: テナント間でデータを共有できますか？

テナント間のデータは完全に分離されています。
データ共有が必要な場合はエクスポート/インポート機能を使用してください。
