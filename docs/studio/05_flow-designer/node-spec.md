# mirel Studio Flow Designer ノード体系仕様

> 業務フローを構成するノードの分類と仕様

---

## 1. 概要

mirel Studio Flow Designer は、業務の「振る舞い」を可視的に定義するためのモジュールである。

フローは **「ノード」と「エッジ（遷移）」** で構成される。

---

## 2. フローノード分類

```
1. イベントノード（起点）
2. データ操作ノード
3. 条件分岐ノード
4. 外部連携ノード
5. 変数操作ノード
6. 通知／アラートノード
7. エラーハンドリングノード
8. 終端ノード
```

---

## 3. ノード仕様

### 3.1 イベントノード（Start）

| イベント | 説明 |
|---------|------|
| onCreate(entity) | エンティティ作成時 |
| onUpdate(entity) | エンティティ更新時 |
| onDelete(entity) | エンティティ削除時 |
| onLoad(form) | フォーム表示時 |
| onButtonClick(form, buttonId) | ボタンクリック時 |
| cron("0 0 * * *") | スケジュール実行 |

**属性：**
- イベント発火元
- 実行条件
- 受け取るコンテキスト（transactionId, before/after data）

### 3.2 データ操作ノード

| ノード | 説明 |
|--------|------|
| Create | 新規レコード作成 |
| Update | 既存レコード更新 |
| Delete | レコード削除 |
| Get | 検索取得 |

**属性：**
- 対象エンティティ
- 条件式
- 書き込みフィールド
- トランザクション境界（将来）

### 3.3 条件分岐ノード

| ノード | 説明 |
|--------|------|
| IF | 条件分岐 |
| Switch | 多分岐（将来） |

**属性：**
- 条件式（model-based）
- フィールド参照
- 分岐ラベル

### 3.4 外部連携ノード

| ノード | 説明 |
|--------|------|
| REST API 呼出 | 外部 REST API の呼び出し |
| Webhook | Webhook 送信 |

**属性：**
- URL
- メソッド
- Body / Header
- 認証方式（API Key / OAuth 将来拡張）
- 成否ルート

### 3.5 変数操作ノード

| ノード | 説明 |
|--------|------|
| Set Variable | 変数の設定 |
| Merge Data | データのマージ |
| Extract Field | フィールドの抽出 |

**属性：**
- スコープ（Flow / Node 単位）
- 値の型
- 出力値

### 3.6 通知ノード

| ノード | 説明 |
|--------|------|
| メール通知 | Email 送信 |
| システム通知 | アプリ内通知（将来） |

**属性：**
- 宛先
- 件名
- 本文
- 動的変数埋め込み

### 3.7 エラーハンドリングノード

| ノード | 説明 |
|--------|------|
| Try/Catch | 例外処理 |
| Retry | リトライ（将来） |

**属性：**
- 例外種類
- リカバリ処理

### 3.8 終端ノード（End）

- Flow 完了
- 戻り値定義（将来）

---

## 4. ノード間エッジの仕様

| 項目 | 仕様 |
|------|------|
| 条件設定 | true/false, success/error |
| 評価順序 | BFS（幅優先） |
| 並列分岐 | 将来拡張 |

---

## 5. Flow Designer が保証するもの

- UI・モデルとの整合性
- 型に基づいた条件式評価
- 実行時エラーの事前検出
- 業務ロジックの可視化と文書化

---

## 関連ドキュメント

- [実行モデル](./execution-model.md)
- [条件式エディタ](./condition-editor.md)
- [パレット拡張](./palette-extension.md)

---

*Powered by Copilot 🤖*
