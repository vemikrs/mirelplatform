# mirel Studio Modeler UI コンポーネント

> Modeler の画面構成と操作仕様

---

## 1. Modeler 全体構造

Modeler は mirel Studio の中心機能であり、業務構造（エンティティ／ビュー／コード）を記述・編集するための UI を持つ。

```
┌──────────────────────────────────────────────────────────────┐
│ 左：モデルツリー                                              │
│（エンティティ／ビュー／コード）                                │
├──────────────────────────────────────────────────────────────┤
│ 中央：モデル編集キャンバス                                     │
│（フィールド編集／関係可視化）                                  │
├──────────────────────────────────────────────────────────────┤
│ 右：プロパティパネル                                          │
│（型／制約／表示名／依存など）                                  │
└──────────────────────────────────────────────────────────────┘
```

---

## 2. UI コンポーネント一覧

### 2.1 モデルツリー（左ペイン）

#### 表示内容

- エンティティ一覧
- フィールド一覧（階層構造で表示）
- 関連先（複合要素）
- コード体系

#### 操作

| 操作 | 説明 |
|------|------|
| ノード追加 | 新規フィールド/エンティティの追加 |
| ドラッグ並び替え | 表示順序の変更 |
| 削除 | フィールド/エンティティの削除 |
| 利用箇所検索 | Form/Flow での参照を検索 |

---

### 2.2 編集キャンバス（中央ペイン）

#### エンティティ編集ビュー

- フィールドテーブル
- 型・必須・キーなどの設定
- 複合モデルの展開・折りたたみ
- 関係図（Graph View）切替

#### 関係ビュー（Graph View）

- エンティティ間の参照関係
- 多階層の依存を可視化
- ノードクリックで右ペインに詳細表示

---

### 2.3 プロパティパネル（右ペイン）

#### 表示項目

| 項目 | 説明 |
|------|------|
| フィールド名 | 識別子 |
| データ型 | string/number/date/domain 等 |
| 必須・キー・ソート順 | 制約設定 |
| 説明 | フィールドの説明文 |
| 関連コードグループ | Code 参照 |
| 親ドメイン | 複合モデル時の親要素 |

#### 動的表示

- 型によって入力欄が変化
- 関係の「利用箇所（read/write）」一覧
- 削除が他のモデルへ影響する場合の警告

---

## 3. ワイヤーフレーム

### 3.1 モデルエクスプローラ

```
┌──────────────────────────────────────────────────────────────┐
│ App Header                                                    │
│  - ワークスペース切替                                         │
│  - 検索バー／最近開いたモデル                                 │
│  - Draft 状態 / Publish ボタン（→ Release Center 連携）       │
├──────────────────────────────────────────────────────────────┤
│ ■ 左：モデルリスト（Explorer）                                │
│                                                              │
│  Search…                                                     │
│                                                              │
│  ENTITY                                                      │
│   - Customer                                                 │
│   - Order                                                    │
│   - OrderLine                                                │
│   ...                                                        │
│                                                              │
│  VIEW                                                        │
│   - OrderSummaryView                                         │
│                                                              │
│  CODE                                                        │
│   - CountryCode                                              │
│   - CustomerType                                             │
│                                                              │
│   [+] 新規モデル作成                                          │
├──────────────────────────────────────────────────────────────┤
│ ■ 中央：モデル詳細                                            │
│  Model: Order (Entity)                                       │
│                                                              │
│  [Overview] [Fields] [Relations] [Usage]                     │
│                                                              │
│  Fields：表形式                                               │
│   | 表示名  | ID | 型 | UI | PK | 必須 | Code | 操作 |        │
│   |--------|-----|-----|----|----|------|------|------|       │
│   | 注文ID |orderId|string|text| ● | ● |      |Edit  |       │
│   ...                                                          │
├──────────────────────────────────────────────────────────────┤
│ ■ 右：視覚化パネル（ER mini map / Structure tree）            │
│                                                              │
│   Order                                                      │
│     ├── orderId : string                                     │
│     ├── customerId : string → Customer                       │
│     └── lines : OrderLine[]                                  │
└──────────────────────────────────────────────────────────────┘
```

### 3.2 モデル定義エディタ

```
┌──────────────────────────────────────────────────────────────┐
│ Model: Order (Entity)                                        │
│ Draft: ● 4件の未公開変更があります                           │
│ [変更破棄] [保存] [保存して公開]                              │
├──────────────────────────────────────────────────────────────┤
│ ■ 左：辞書ツリー（Domain Tree）← Single Source of Truth      │
│                                                              │
│ Order                                                        │
│   ├── orderId : string* （PK）                               │
│   ├── customerId : string [Code: CustomerType]               │
│   ├── orderDate : date                                       │
│   └── lines : DOMAIN (OrderLine)[*]                          │
│         ├── lineId : string                                  │
│         ├── qty : number                                     │
│         └── price : number                                   │
│                                                              │
│ ※ドラッグで順序入替、右クリックで追加/削除                   │
├──────────────────────────────────────────────────────────────┤
│ ■ 右：プロパティ編集パネル（Properties）                      │
│                                                              │
│ Node: customerId                                             │
│                                                              │
│ [基本] [表示] [バリデーション] [関連]                        │
│                                                              │
│ 基本：                                                       │
│   フィールドID       customerId                              │
│   表示名             顧客ID                                  │
│   型                 string ▼                                │
│   コードグループ     CustomerType ▼                          │
│   必須               [✔]                                     │
│   PK                 [ ]                                     │
└──────────────────────────────────────────────────────────────┘
```

---

## 4. 編集アクション

| アクション | 説明 |
|-----------|------|
| フィールド追加 | 新規フィールドを追加 |
| フィールド削除 | フィールドを削除（影響チェック付き） |
| 複合モデルへの差し替え | プリミティブ → ドメインへ変更 |
| 型変更時の依存チェック | Form/Flow への影響を検出 |
| 利用箇所一覧の表示 | どこで使われているか確認 |
| エンティティ間コピー | フィールド定義をコピー |
| コードグループ紐付け | Code との関連設定 |

---

## 5. Modeler が担う役割

- **業務の構造を一貫性を保って外在化する**
- **UI・フロー・API の派生元としての SSOT の役割**
- **変更による破壊を防ぐための依存性管理**

---

## 関連ドキュメント

- [Modeler 概要](./overview.md)
- [エラー検出](./error-detection.md)
- [Form Designer Widget 仕様](../04_form-designer/widget-spec.md)

---

*Powered by Copilot 🤖*
