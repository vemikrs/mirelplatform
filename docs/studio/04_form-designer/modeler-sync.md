# mirel Studio Modeler–Form Designer 同期仕様

> 構造（Modeler）と画面（Form Designer）の緩やかな双方向同期

---

## 1. 同期の基本原則

mirel Studio の中核となる「構造（Modeler）」と「画面（Form Designer）」は、完全に独立ではなく **緩やかな双方向同期** を行う。

```
Model → Form : 自動反映（強制）
Form → Model : 部分的反映（許容）
```

Modeler を SSOT としつつ、Form 側の小規模カスタマイズも認める。

---

## 2. モデル変更時の同期

### 2.1 フィールド追加

- Form Designer 側に「未配置フィールド」として追加
- Builder は配置の必要があることを通知

### 2.2 フィールド削除

- 配置済みフィールドを「孤立状態」としてマーク
- Form から自動削除するかの選択をユーザーに提示

### 2.3 型変更

- 互換性チェックを実施
- 不一致がある場合：
  - 警告を表示
  - 代替ウィジェットへの変換を提案

---

## 3. Form Designer からの更新

Form 側の変更は Model にすべて反映されるわけではない。

### 3.1 反映されるもの（構造的）

| 項目 | 説明 |
|------|------|
| 表示名 | フィールドのラベル |
| ヘルプテキスト | 入力補助の説明文 |
| タイトルの付与 | セクションタイトル |
| セクション分割 | 論理的なグループ化 |

### 3.2 反映されないもの（UI 表現）

| 項目 | 説明 |
|------|------|
| レイアウト（グリッド） | 画面配置のみ |
| コンポーネントサイズ | 表示幅のみ |
| 表示条件 | Form のロジック扱い |

---

## 4. 同期タイミング

| タイミング | 処理 |
|-----------|------|
| Builder 保存時 | 変更の検出と同期 |
| Draft 作成時 | 差分の計算 |
| Release 作成時 | 強制整合チェック |

---

## 5. コンフリクト解決モデル

### Case 1：Model にフィールドがあるが Form にない

→ Form Designer 側で「未配置」として通知

### Case 2：Form に存在し Model に存在しない

→ Form Designer は「孤立フィールド」として扱い削除を提案

### Case 3：型不一致

→ 修正案を提示し、いずれかをユーザーが選択

---

## 6. 設計目的

- SSOT の破壊防止
- Builder 作業の安全性向上
- Form Designer の自由度確保
- 大規模モデル変更への強さ

---

## 関連ドキュメント

- [Widget 仕様](./widget-spec.md)
- [Modeler 概要](../03_modeler/overview.md)
- [エラー検出](../03_modeler/error-detection.md)

---

*Powered by Copilot 🤖*
