# mirel Studio Release 差分マージ機能

> 複数 Draft の統合と Draft 間コンフリクト解決

---

## 1. 必要性（ユースケース）

- 複数人が異なる Draft を作成
- 片方だけ Release 化すると、片方の作業が失われる
- これを防ぐため、Draft 同士のマージが必要

---

## 2. マージ対象

| 対象 | 説明 |
|------|------|
| Model | エンティティ・フィールド定義 |
| Form | レイアウト・ウィジェット配置 |
| Flow | ノード・条件・遷移 |
| Code 定義 | コードグループ・ラベル |

---

## 3. マージアルゴリズム

### 3.1 差分分類

```json
{
  "added": [...],
  "updated": [...],
  "removed": [...]
}
```

### 3.2 コンフリクト検出

**例：**
- A が `customer.address.zip` を text → number に変更
- B が `customer.address.zip` を string → text に変更

これらは **型変更の競合** として検出。

---

## 4. UI 表示

```
A と B の差分を表示
─────────────────────
フィールド名: customer.address.zip
  A: number
  B: text
─────────────────────
[ A を採用 ] [ B を採用 ]
```

---

## 5. マージポリシー

| ポリシー | 対象 |
|---------|------|
| 自動マージ | 追加・非競合の変更 |
| 手動マージ | 型変更・フィールド削除 |
| 非推奨 | 同一 Flow の条件式に対する同時編集 |

---

## 6. Release 作成時のチェック

```
① Draft に未マージ差分がある場合警告
② 手動マージが必要な箇所を表示
③ Release 生成は可能だが、影響分析を推奨
```

---

## 7. 設計意図

- 組織での同時開発を支える
- 版管理のヒューマンエラーを減らす
- Git 無しでも差分管理ができるようにする

---

## 関連ドキュメント

- [Draft 版管理ポリシー](./draft-versioning.md)
- [差分検出アルゴリズム](./diff-algorithm.md)
- [Draft/Release データモデル](./draft-release-model.md)

---

*Powered by Copilot 🤖*
