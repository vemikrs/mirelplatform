# mirelplatform ナビゲーション設計書

（Navigation Architecture / v2025-01）

## 1. 目的

mirelplatform における複数モジュール（ProMarker / Studio / 業務ワークフロー / 管理機能）を、
ユーザーが一貫して操作できる情報構造を確立する。
特に、以下の要求を満たすことを目的とする：

- 階層化された動的メニューを安定して表示する
- モジュール数が増加しても UI を破壊しない構造
- ライセンス・権限に応じてメニューを自動調整できる
- エンプラ利用に耐えうるアクセス効率（最小のクリック数）
- NavBar に過剰な情報を載せず、利用体験の負荷を軽減する

最終ゴールは「構造化メニューを左レールに集約した、エンプラ向け UI」の実現である。

---

## 2. ナビゲーション全体構造（3ゾーンモデル）

mirelplatform の標準レイアウトは以下の 3 ゾーンで構成する。

```

────────────────────────────
AppBar（全体共通）
────────────────────────────
│ Permanent Left Navigation（動的メニュー） │ Main Content
│ │
│ │
│ │
───────────────────────────────────────────────────

```

### 2.1 AppBar（画面最上段）

用途：グローバル操作のみ

- Workspace 切替
- 通知（Notification）
- プロフィール / ロール情報
- グローバル検索（全モジュール横断）
- ヘルプ / ドキュメント
- 右側アクションボタン（任意：作成・追加）

**禁止事項**
AppBar に階層メニューを置かない。
（AWS / Azure / GitHub と同じ原則）

---

## 3. Permanent Left Navigation（構造化メニュー）

### 3.1 基本方針

- 左端に常時表示する「永続ナビ」形式
- モジュール → 機能 → 画面 の 3 層構造を扱える
- ライセンス / 権限に応じて自動調整される
- Rails（アイコンのみ）⇄ Expanded（フル表示）の切替が可能

### 3.2 構造モデル（情報アーキテクチャ）

```

mirelplatform
├─ ポータル（Dashboard）
├─ ProMarker
│ ├─ ステンシル
│ ├─ 辞書
│ ├─ コード生成
│ └─ テンプレート管理
├─ Studio
│ ├─ フォームビルダー
│ ├─ データモデル
│ └─ テスト環境
├─ 業務ワークフロー
│ ├─ プロセス定義
│ ├─ 実行 / タスク一覧
│ └─ 監査ログ
└─ 管理機能（mirelplatform）
├─ ユーザー・ロール管理
├─ ライセンス管理
├─ メニュー定義管理（動的メニュー）
└─ システム設定

```

### 3.3 動的制御（ライセンス/権限による表示条件）

例：

- **ProMarker FREE**
  - 基本生成のみ表示
  - ステンシル編集/辞書管理は非表示

- **ワークスペース管理者**
  - ユーザー管理 / メニュー管理 が表示

- **Studio BETA**
  - Studio セクションのみ表示
  - ワークフローは非表示など

---

## 4. メニュー表示パターン

### 4.1 Expanded（標準表示）

左幅 240px 程度
テキストラベル＋アイコンで階層展開。

メリット

- 3階層まで自然に扱える
- 新規モジュール追加時の拡張性が高い

### 4.2 Rail Mode（縮小）

幅 72px
アイコンのみ表示。
ホバー/クリックで一時的に展開。

利用場面

- Studio / Builder など横幅が重要な UI
- 既に画面構造を理解している熟練者

---

## 5. 画面遷移の標準規約

### 5.1 モジュール単位の遷移

左ナビでモジュールを切り替えると、
Main Content はそのモジュールの “Landing Page” に移動する。

例
ProMarker → `/promarker`
Studio → `/studio`

### 5.2 機能単位の遷移

階層タップで機能ページへ遷移。

例
ステンシル → `/promarker/stencil`

### 5.3 ポータルとの関係

ロゴクリック → `/portal`

---

## 6. 権限・ロール・ライセンスによるメニュー生成ロジック

### 6.1 生成プロセス（サーバ側）

```

ユーザー情報
├─ ロール
├─ 権限
└─ 契約ライセンス
↓
メニュー定義（データベース）
↓
アクセス制御（RBAC / ABAC）
↓
クライアントへ JSON として提供

```

例：
`menu.json`

```jsonc
{
  "id": "promarker",
  "label": "ProMarker",
  "icon": "lucide-wand",
  "children": [
    {
      "id": "stencil",
      "label": "ステンシル",
      "path": "/promarker/stencil",
      "license": ["PRO", "MAX"],
    },
  ],
}
```

---

## 7. レイアウト上の優先順位（UI上の配置ルール）

1. AppBar
   - グローバル操作（検索 / 通知 / プロフィール）

2. Left Navigation
   - 構造化メニュー
   - モジュール階層
   - システム管理

3. Main Content（最大面積を割り当てる）
   - ポータル
   - 各モジュール画面

---

## 8. mirelplatform に適したカラー/デザイン指針（推奨）

- LeftNav 背景：light-gray ～ white（Azure Portal系）
- Active 状態：ブルートーンのアクセント
- アイコン：Lucide ベース（既存実装と整合）
- Hover は控えめで、業務用途に寄せた落ち着いたトーン

---

## 9. 導入フェーズ

### Phase 1（すぐできる）

- 左ナビの設置（Expanded固定でOK）
- NavBar からモジュールタブを排除
- ポータルとの遷移導線を明確化

### Phase 2

- 動的メニュー JSON スキーマの定義
- RBAC / ライセンス連動実装

### Phase 3

- Rail Mode 対応
- 検索ドリブンナビ（Quick Search）の導入

---

## 10. 最終構成イメージ（画面例）

```
┌────────────────────────────────────────────────── AppBar ──────┐
│  Workspace ▼    検索バー                    通知   プロフィール │
└───────────────────────────────────────────────────────────────┘
│ ProMarker                                               │
│   ├ ステンシル                                           │
│   ├ 辞書                                                │
│   └ コード生成                                          │ Main Content
│ Studio                                                  │
│   ├ フォーム                                           │
│   └ データモデル                                       │
│ ワークフロー                                           │
│   └ 定義/実行                                          │
│ 管理                                                   │
│   ├ ユーザー管理                                        │
│   └ メニュー管理                                        │
└───────────────────────────────────────────────────────────────┘
```

---

## 付録：ファイル名

`meta/navigation-design.md`
